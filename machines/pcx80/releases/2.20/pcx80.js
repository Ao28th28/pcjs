(function(){/*
 https://www.pcjs.org/modules/v2/messages.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/dumpapi.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/reportapi.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/userapi.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/keys.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/strlib.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/weblib.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/cpudef.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/state.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/embed.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/defines.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/usrlib.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/component.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/panel.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/bus.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/memory.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/cpu.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/cpustate.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/cpuops.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/chipset.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/rom.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/ram.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/keyboard.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/video.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/serial.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/debugger.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/computer.js (C) 2012-2023 Jeff Parsons
*/
var l;function ca(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function da(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ca(a)}}function ea(a){if(!(a instanceof Array)){a=da(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
var ha="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},ia="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ja(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var la=ja(this);function ma(a,b){if(b)a:{var c=la;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ia(c,a,{configurable:!0,writable:!0,value:b})}}var na;
if("function"==typeof Object.setPrototypeOf)na=Object.setPrototypeOf;else{var oa;a:{var pa={a:!0},qa={};try{qa.__proto__=pa;oa=qa.a;break a}catch(a){}oa=!1}na=oa?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ra=na;
function ta(a,b){a.prototype=ha(b.prototype);a.prototype.constructor=a;if(ra)ra(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Mf=b.prototype}function ua(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
ma("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}});ma("Number.isNaN",function(a){return a?a:function(b){return"number"===typeof b&&isNaN(b)}});
ma("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.g=f;ia(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
ma("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=la[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ia(d.prototype,a,{configurable:!0,writable:!0,value:function(){return va(ca(this))}})}return a});function va(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function wa(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}ma("Array.prototype.keys",function(a){return a?a:function(){return wa(this,function(b){return b})}});var xa="undefined"!=typeof window?{}:null,ya="undefined"!=typeof window?{}:global,n="undefined"!=typeof window?window:global,za="undefined"!=typeof document?document:{};
n.PCjs||(n.PCjs={});var Aa=n.PCjs;Aa.machines||(Aa.machines={});Aa.components||(Aa.components=[]);Aa.commands||(Aa.commands={});
var t={warn:549755813888,halt:70368744177664,buffer:0x800000000000},v={xe:0,Ae:1,Be:2,Ce:3,De:4,Ee:5,Fe:6,Ge:7,He:8,Ie:9,Je:10,Ke:11,Le:12,Me:13,Ne:14,Oe:15,Pe:16,Qe:17,Re:18,Se:19,Te:20,Ue:21,Ve:22,We:23,Xe:24,Ye:25,Ze:26,ef:27," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,ab:65,Vb:66,Wb:67,Cb:68,E:69,Yb:70,Zb:71,$b:72,ac:73,bc:74,dc:75,
Fb:76,ic:77,jc:78,nc:79,oc:80,Q:81,pc:82,rc:83,sc:84,tc:85,vc:86,wc:87,yc:88,zc:89,vb:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,Ad:103,Cd:104,Ed:105,Nd:106,k:107,Od:108,Qd:109,n:110,Rd:111,p:112,q:113,r:114,me:115,t:116,oe:117,pe:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,$e:127},Ba={59:186,61:187,173:189,224:91};function Ca(){}
function Ea(a,b){if(a){b||(b=10);var c,d=0<a.indexOf(",");d&&(a=a.replace(/,/g,""));var e=c=a.charAt(0);"#"==c?(b=8,c=""):"$"==c&&(b=16,c="");e!=c?a=a.substr(1):(e=c=a.substr(0,2),"0b"==c&&d||"^B"==c?(b=2,c=""):"0o"==c||"^O"==c?(b=8,c=""):"^D"==c?(b=10,c=""):"0x"==c&&(b=16,c=""),e!=c&&(a=a.substr(2)));e=c=a.slice(-1);"Y"==c||"y"==c?(b=2,c=""):"."==c?(b=10,c=""):"H"==c||"h"==c?(b=16,c=""):"K"==c?c="000":"M"==c?c="000000":"G"==c&&(c="000000000");e!=c&&(a=a.slice(0,-1)+c);var f;e=0;10>=b&&(c=a.match(/(-?[0-9]+)B([0-9]*)/))&&
(a=c[1],e=35-((c[2]||35)&255));if((b&&10!=b?16==b?null!==a.match(/^-?[0-9a-f]+$/i):8==b?null!==a.match(/^-?[0-7]+$/):2==b&&null!==a.match(/^-?[01]+$/):null!==a.match(/^-?[0-9]+$/))&&!isNaN(f=parseInt(a,b))){e&&(0>f&&(f+=Math.pow(2,36)),f=0<e?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));var g=f}}return g}
function Ga(a,b,c,d,e){e=void 0===e?0:e;var f="";isNaN(a)||"number"!=typeof a?a=null:(0>a&&-1<a&&(a=-1),0>a&&(a+=Math.pow(b,c)),a>=Math.pow(b,c)&&(c=Math.ceil(Math.log(a)/Math.log(b))));for(var g=e||-1;0<c--;){g||(f=","+f,g=e);if(null==a)f="?"+f;else{var h=a%b;h+=0<=h&&9>=h?48:55;f=String.fromCharCode(h)+f;a=Math.trunc(a/b)}g--}return(void 0===d?"":d)+f}function w(a,b,c){b?9<b&&(b=9):(b=Math.abs(a),b=65535>=b?4:4294967295>=b?8:9);return Ga(a,16,b,c?"0x":"")}function Ia(a){return w(a,4,!0)}
function Ja(a){var b=a,c=a.lastIndexOf("/");0<=c&&(b=a.substr(c+1));c=b.indexOf("&");0<c&&(b=b.substr(0,c));return b}function Ka(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase(),"json5"==b&&(b="json"));return b}function La(){var a=n.location?n.location.hostname:"localhost";return-1!==a.indexOf("pcjs.org",a.length-8)}function Ma(a){return a.replace(/[&<>"'$]/g,function(b){return Na[b]})}function Oa(a,b){return(a+"                                        ").slice(0,b)}
function Pa(){var a=ua.apply(0,arguments);return void 0===a[0]?new Date(Date.now()):"string"===typeof a[0]?new Date(a[0]+" "+(a[1]||"00:00:00 GMT")):void 0===a[1]?new Date(a[0]):new Date(Date.UTC.apply(Date,ea(a)))}
function Qa(a){var b=ua.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([hlL]?)([A-Za-z%])/),e=0,f;for(f=0;f<d.length-6;f+=6){c+=d[f];var g=d[f+5],h="ACDFGHMNSTWYbdfjcsoXx%".indexOf(g);if(0>h)c+="%"+d[f+1]+d[f+2]+d[f+3]+d[f+4]+g;else{if(e<b.length){var k=b[e];"%"!=g&&e++}else k=b[b.length-1];var m=d[f+1],p=0<=m.indexOf("#"),u=0<=m.indexOf("0"),r=d[f+2];"*"==r?(r=k,k=e<b.length?b[e++]:b[b.length-1]):r=+r||0;var q=d[f+3];q=q?+q.substr(1):-1;var y=null,
D=0,E="";h=12>h&&"object"!=typeof k?Pa(k):k;switch(g){case "C":k=p?"#":"";c+=isNaN(h.getTime())?void 0:Qa(Qa("%%%sW, %%%sF %%%sD, %%%sY",k),h);continue;case "D":k=p?h.getUTCDate():h.getDate();g="d";break;case "A":case "G":case "H":k=p?h.getUTCHours():h.getHours();"A"==g?(k=12>k?"am":"pm",g="s"):("G"==g&&(k=k?12<k?k-12:k:12),g="d");break;case "F":case "M":k=p?h.getUTCMonth():h.getMonth();"F"==g?(k=Ra[k],g="s"):(k++,g="d");break;case "N":k=p?h.getUTCMinutes():h.getMinutes();g="d";break;case "S":k=p?
h.getUTCSeconds():h.getSeconds();g="d";break;case "T":k=p?"#":"";c+=isNaN(h.getTime())?void 0:Qa(Qa("%%%sY-%%%s02M-%%%s02D %%%s02H:%%%s02N:%%%s02S",k),h);continue;case "W":k=Ta[p?h.getUTCDay():h.getDay()];g="s";break;case "Y":k=p?h.getUTCFullYear():h.getFullYear(),0<q&&(k%=Math.pow(10,q),q=-1),g="d"}switch(g){case "b":c+=k?"true":"false";break;case "d":k=Math.trunc(k),0<=q&&(u=!0,r<q&&(r=q),q=-1);case "f":g=k+"";0<=q&&(g=k.toFixed(q));g.length<r&&(u?(0>k&&(r--,g=g.substr(1)),g=("0000000000"+g).slice(-r),
0>k&&(g="-"+g)):g=("          "+g).slice(-r));c+=g;break;case "j":c+=JSON.stringify(k,null,r||void 0);break;case "c":k="string"==typeof k?k[0]:String.fromCharCode(k);case "s":if(void 0!=k)for("string"!=typeof k&&(k=k.toString()),0<=q&&(k=k.substr(0,q));k.length<r;)k=0<=m.indexOf("-")?k+" ":" "+k;c+=k;break;case "o":D=8,p&&(E="0o");case "X":y=Ua;case "x":g="";D||(D=16);!E&&p&&(E="0x");y||(y=Va);k=Math.trunc(k);0<=q&&(u=!0,r<q&&(r=q));u&&!r&&(r=Math.abs(k),r=255>=r?2:65535>=r?4:4294967295>=r?8:9,r+=
E.length);r-=E.length;do p=16,Number.isNaN(k)||(p=k&D-1,k=Math.trunc(k/D)),u||!g||p||k?g=y[p]+g:(E&&(g=E+g,E=""),0<r&&(g=" "+g));while(0<--r||k);c+=E+g;break;case "%":c+="%";break;default:c+="(unimplemented printf type %"+g+")"}}}return c+=d[f]}function Wa(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}
var Na={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;",$:"&dollar;"},Xa={0:"NUL",1:"SOH",2:"STX",3:"ETX",4:"EOT",5:"ENQ",6:"ACK",7:"BEL",8:"BS",9:"TAB",10:"LF",11:"VT",12:"FF",13:"CR",14:"SO",15:"SI",16:"DLE",17:"XON",18:"DC2",19:"XOFF",20:"DC4",21:"NAK",22:"SYN",23:"ETB",24:"CAN",25:"EM",26:"SUB",27:"ESC",28:"FS",29:"GS",30:"RS",31:"US",127:"DEL"},Va="0123456789abcdef?",Ua="0123456789ABCDEF?",Ta="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ra="January February March April May June July August September October November December".split(" ");
function Ya(a,b,c){var d=0,e=a.length,f=0;for(void 0===c&&(c=function(k,m){return k>m?1:k<m?-1:0});d<e;){var g=d+e>>1,h=void 0;h=c(b,a[g]);0<h?d=g+1:(e=g,f=!h)}return f?d:~d}function Za(a,b){if(Array.prototype.indexOf)return a.indexOf(b,c);var c=c||0;0>c&&(c+=a.length);0>c&&(c=0);for(var d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1}
function $a(a,b,c,d){function e(){if(4!==m.readyState)return null;try{g=p?m.response:m.responseText}catch(q){}if(null==g||200!=m.status&&(m.status||!g.length||"file:"!=(n.location?n.location.protocol:"file:")))if(f=m.status||-1,!m.status&&!ab){var r=a.match(/(^https?:\/\/[^/]+)(.*)/);r&&(ab=!0,x("PCjs was unable to perform a cross-origin resource request to '"+r[1]+"'.\n\nIf you're running an ad blocker, try adding '"+bb()+"' to your whitelist (or find a smarter ad blocker)."))}d&&d(a,g,f);return[g,
f]}b=void 0===b?"text":b;c=void 0===c?!1:c;var f=0,g=null,h=null,k=n.resources;if("object"==typeof k&&(g=k[a]))return d&&d(a,g,f),[g,f];if(c&&"function"==typeof k)return k(a,function(r,q){d&&d(a,r,q)}),h;a=a.replace(/^\/(disks\/|)(diskettes|gamedisks|miscdisks|harddisks|decdisks|pcsigdisks|pcsig[0-9a-z]*-disks|private)\//,"https://$2.pcjs.org/").replace(/^\/(disks\/cdroms|discs)\/([^/]*)\//,"https://$2.pcjs.org/");if(ya.he)return g=ya.he(a),d&&d(a,g,f),h;var m=n.XMLHttpRequest?new n.XMLHttpRequest:
new n.ActiveXObject("Microsoft.XMLHTTP"),p=!1;k="string"===typeof m.responseType;c&&(m.onreadystatechange=e);if(b&&"object"==typeof b){k="";for(var u in b)b.hasOwnProperty(u)&&(k&&(k+="&"),k+=u+"="+encodeURIComponent(b[u]));k=k.replace(/%20/g,"+");m.open("POST",a,c);m.setRequestHeader("Content-type","application/x-www-form-urlencoded");m.send(k)}else m.open("GET",a,c),"arraybuffer"==b&&(k?(p=!0,m.responseType=b):m.overrideMimeType("text/plain; charset=x-user-defined")),m.send();c||(m.readyState=4,
h=e());return h}
function cb(a,b){var c,d={na:null,sa:null,Qa:null,Ha:null};if("["==b.charAt(0)||"{"==b.charAt(0))try{var e,f;if("<"==b.charAt(0))throw Error(b);if(0>b.indexOf("0x")&&0>b.indexOf("0o")&&'["'!=b.substr(0,2)){0>b.indexOf('"values"')&&(b=b.replace(/([a-z]+):/gm,'"$1":').replace(/\/\/[^\n]*/gm,""));var g=JSON.parse(b)}else g=eval("("+b+")");d.Qa=g.load;d.Ha=g.exec;var h=g.width,k=g.values;h&&k&&(8==h?g.bytes=k:16==h?g.words=k:32==h?g.longs=k:g.data=k);if(e=g.bytes)d.na=e;else if(e=g.words)for(d.na=Array(2*
e.length),f=c=0;c<e.length;c++)d.na[f++]=e[c]&255,d.na[f++]=e[c]>>8&255;else if(e=g.longs)for(d.na=Array(4*e.length),f=c=0;c<e.length;c++)d.na[f++]=e[c]&255,d.na[f++]=e[c]>>8&255,d.na[f++]=e[c]>>16&255,d.na[f++]=e[c]>>24&255;else(e=g.data)?d.Jf=e:d.na=g;d.na&&(d.na.length?1==d.na.length&&(x(d.na[0]),d=null):(x("Empty resource: "+a),d=null));d.sa=g.symbols}catch(m){x("Resource data error ("+a+"): "+m.message),d=null}else{e=[];b=b.replace(/\n/gm," ").replace(/ +$/,"").split(" ");for(c=0;c<b.length;c++){f=
parseInt(b[c],16);if(isNaN(f)){x("Resource data error ("+a+"): invalid hex byte ("+b[c]+")");break}e.push(f&255)}c==b.length&&(d.na=e)}return d}function bb(){return n.location?n.location.protocol+"//"+n.location.host:"https://www.pcjs.org"}function db(){return n.navigator?n.navigator.userAgent:""}
function ib(){if(null==jb){var a=!1;if(n.localStorage)try{n.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==n.localStorage.getItem("PCjs.localStorage"),n.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}jb=a}return jb}function kb(a){if(ib())try{var b=n.localStorage.getItem(a)}catch(c){}return b}function lb(a,b){if(ib())try{return n.localStorage.setItem(a,b),!0}catch(c){}return!1}
function mb(a){if(n.navigator){var b=db();return"iOS"==a&&(!!b.match(/(iPod|iPhone|iPad)/)||"MacIntel"===n.navigator.platform&&1<n.navigator.maxTouchPoints)||"MSIE"==a&&!!b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)}return!1}function nb(a,b,c){if(a)for(var d=0;d<ob.length;d++){var e=ob[d];if(c){if(e+=c,b+e in a)return e}else if(e=e?e+b[0].toUpperCase():b[0],e+=b.substr(1),e in a)return e}return null}
function pb(a){if(!qb){var b,c={};if(n.location){b||(b=n.location.search.substr(1));for(var d,e=/\+/g,f=/([^&=]+)=?([^&]*)/g;d=f.exec(b);)c[decodeURIComponent(d[1].replace(e," "))]=decodeURIComponent(d[2].replace(e," "))}qb=c}return qb[a]||qb[a.toLowerCase()]}function rb(a,b,c){function d(){--a;0<=a&&(b()||(a=0));0<a?setTimeout(d,0):c()}d()}
function tb(a,b){function c(){b(100===d)&&(e=setTimeout(c,d),d=100)}var d=0,e=null,f=!1;a.onmousedown=function(){f||e||(d=500,c())};a.ontouchstart=function(){e||(d=500,c())};a.onmouseup=a.onmouseout=function(){e&&(clearTimeout(e),e=null)};a.ontouchend=a.ontouchcancel=function(){e&&(clearTimeout(e),e=null);f=!0}}function ub(a,b){var c=n[a];n[a]="function"!==typeof c?b:function(){c&&c();b()}}function vb(a){wb.init.push(a)}
function xb(a){yb(a+"\n\nIf it happens again, please send the URL to support@pcjs.org. Thanks.")}function zb(a){if((a=wb[a])&&Ab)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){xb("An unexpected error occurred: "+c.message)}}function Bb(a){!Ab&&a?(Ab=!0,Cb&&zb("init"),Db&&zb("show")):Ab=a}var qb=null,wb={init:[],show:[],exit:[]},ob=["","moz","ms","webkit"],Cb=!1,Db=!1,Ab=!0,ab=!1,jb=null;ub("onload",function(){Cb=!0;zb("init",!0)});ub("onpageshow",function(){Db=!0;zb("show",!0)});
ub(mb("iOS")?"onpagehide":mb("Opera")?"onunload":"onbeforeunload",function(){zb("exit",!0)});
function z(a,b,c){this.type=a;b||(b={id:"",name:""});this.name=b.name;this.xc=b.comment;this.Bd=b;this.id=this.id=b.id||"";this.exports={};this.R=this.bindings={};a=this.id.indexOf(".");0>a?(this.Sa="PCjs",this.Gb=this.id):(this.Sa=this.id.substr(0,a),this.Gb=this.id.substr(a+1));this.flags={ready:!1,kb:!1,Hb:!1,Kf:!1,ka:!1,Qb:!1,error:!1};this.yb=null;this.flags.error=!1;this.ga=c||0;this.L=this.A=this.J=this.S=null;Aa.components.push(this)}
function Gb(a,b,c){Aa.machines[a]&&b&&(Aa.machines[a][b]=c,"parms"==b&&"string"==typeof c&&(Aa.machines[a].config=eval("("+c+")")))}function Hb(){return Date.now()||+new Date}function yb(a,b,c){b||x((c?c+": ":"")+a)}function x(a){window&&window.alert(a)}function Ib(a){var b=!1;window&&(b=window.confirm(a));return b}
function Jb(a,b){b=Kb("pcx80-control","",b.parentNode);for(var c=0;c<b.length;c++)for(var d=b[c].childNodes,e=0;e<d.length;e++){var f=d[e];if(1===f.nodeType){var g=f.getAttribute("class");if(g)for(var h=g.split(" "),k=0;k<h.length;k++)switch(g=h[k],g){case "pcx80-binding":(g=Lb(f))&&void 0!==g.binding&&a.ea(g.type,g.binding,f,g.value),k=h.length}}}}
function Mb(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");var d=Aa.components;for(b=0;b<d.length;b++){var e=d[b];a&&e.id.indexOf(a)||c.push(e)}return c}function Nb(a){if(void 0!==a){var b,c=Aa.components;for(b=0;b<c.length;b++)if(c[b].id===a)return c[b]}return null}
function Ob(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");var e=Aa.components;for(d=0;d<e.length;d++)if(c)c==e[d]&&(c=null);else if(!(a!=e[d].type||b&&e[d].id.indexOf(b)))return e[d]}return null}function Lb(a){var b=null;if(a.getAttribute){if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(d){x(d.message+" ("+a+")")}}else if(b=a.config||null){a=a.id;var c=b.id;a&&c&&0>c.indexOf(".")&&(b.id=a+"."+c)}return b}
function Kb(a,b,c){b=void 0===b?"":b;c=void 0===c?za:c;var d=[];b&&(a+="-"+b,"machine"!=b&&(a+="-object"));if(c.getElementsByClassName)d=c.getElementsByClassName(a);else if(c.getElementsByTagName){b=c.getElementsByTagName("*");var e=new RegExp("(^| )"+a+"( |$)");a=0;for(c=b.length;a<c;a++)e.test(b[a].className)&&d.push(b[a])}else for(a=Object.keys(Aa.machines),c=0;c<a.length;c++){e=a[c];var f=Aa.machines[e].config;if(f&&(f=f[b])){Array.isArray(f)||(f=[f]);f=da(f);for(var g=f.next();!g.done;g=f.next())d.push({id:e,
config:g.value})}}return d}
function Pb(a){for(var b=!0,c=Aa.commands[a];c&&c.length;){var d=c.splice(0,1)[0],e=d[0],f=null;0<=Qb.indexOf(e)&&(f=function(){return function(){Pb(a)}}());var g=Rb[e];if(g)if(!f)b=g(d[1],d[2],d[3]);else{if(!g(f,d[1],d[2],d[3]))break}else{b=!1;var h=Ob(d[1],a);if(h)if(g=Sb[e])b=g(h,d[2],d[3]);else{var k=h.exports;if(k&&(g=k[e]))if(b=!0,!f)b=g.call(h,d[2],d[3]);else if(!g.call(h,f,d[2],d[3]))break}}if(!b){x("Script error: '"+e+"' command "+(g?" failed":" not recognized"));break}}c&&!c.length&&delete c[a];
return b}l=z.prototype;l.toString=function(){return this.name?this.name:this.id||this.type};
l.ea=function(a,b,c){switch(b){case "clear":return this.R[b]||(this.R[b]=c,c.onclick=function(d){return function(){d.R.print&&(d.R.print.value="")}}(this)),!0;case "print":return this.R[b]||(this.R[b]=c,this.ba=function(d){this.ia(d,this.type);return!0},c.value="",this.print=function(d,e){return function(f,g){f||(f="");if(4398046511104==(void 0===g?0:g)&&"...\n"==f.slice(-4)){g=f.slice(0,-1);var h=e.value,k=h.lastIndexOf(g);h=0>k?h+(g+"\n"):h.substr(0,k)+(f.slice(0,-1)+".")+h.substr(k+g.length);8192<
h.length&&(h=h.substr(h.length-4096));e.value=h}else e.value+=f,f=e.value,8192<f.length&&(e.value=f.substr(f.length-4096));e.scrollTop=e.scrollHeight}}(this,c)),!0;default:return!1}};l.log=function(){};l.print=function(){};l.ia=function(a){this.print(a+"\n")};l.status=function(a){this.u.apply(this,[137438953472,a].concat(ea(ua.apply(1,arguments))))};
l.ba=function(a,b,c){if(!b){var d=Ob("Computer",this.id);if(d&&d.flags.Qb)return console.log("ignoring notice during unload: "+a),!1}yb(a,b,c||this.type);return!0};function Tb(a,b){a.flags.error=!0;a.ba(b)}function Ub(a,b){b&&(a.flags.ready?b():a.yb=b);return a.flags.ready}function Vb(a){if(!a.flags.error&&(a.flags.ready=!0,a.flags.ready)){var b=a.yb;a.yb=null;b&&b()}}function Wb(a,b){a.flags.kb&&(b?a.flags.Hb=!0:void 0===b&&a.print(a.toString()+" busy\n"));return a.flags.kb}
function Xb(a,b){if(a.flags.Hb)return a.flags.kb=!1,a.flags.Hb=!1;if(a.flags.error)return a.print(a.toString()+" error\n"),!1;a.flags.kb=b;return a.flags.kb}l.wa=function(){return this.flags.ka=!0};l.va=function(a,b){b&&(this.flags.ka=!1);return!0};function Yb(a,b){var c=Math.pow(2,32),d=b/c|0;return(a&b)==(b|0)&&((a/c|0)&d)==d}function Zb(a,b){b=(void 0===b?0:b)||a.ga;b&1&&--b;return!b||Yb(0xff000000000,b)||a.L&&Yb(a.L.ga,b)?!0:!1}
l.u=function(a){var b=ua.apply(1,arguments),c=0;"number"==typeof a&&(c=a||4398046511104,a=b.shift(),137438953472==c&&(a=this.type+": "+a));Zb(this,c)&&(b=Qa.apply(Ca,[a].concat(ea(b))),this.L&&this.L.message?this.L.message(b,c):this.print(b,c),549755813888!=c&&1099511627776!=c||x(b.trim()))};function ec(a,b){var c=void 0===c?a.ga:c;a.L&&("boolean"==typeof c&&(c=c?4398046511104:0),a.L.u(c,"%s\n",b))}function A(a,b,c,d,e,f,g){g=void 0===g?a.ga:g;a.L&&(!0===g&&(g=0),fc(a.L,a,b,c,d,e,f,g))}
var Qb=["hold","sleep","wait"],Rb={alert:function(a){x(a);return!0},sleep:function(a,b){setTimeout(a,+b);return!1}},Sb={select:function(a,b,c){var d=!1;if(a=a.bindings[b])for(b=0;b<a.options.length;b++)if(a.options[b].textContent==c){a.selectedIndex!=b&&(a.selectedIndex=b);d=!0;break}return d}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b=b||0;for(var c=this.length;b<c;b++)if(this[b]===a)return b;return-1});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});
Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return e.apply(this instanceof c&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))}function c(){}if("function"!=typeof this)throw new TypeError("Function.prototype.bind: non-callable object");var d=Array.prototype.slice.call(arguments,1),e=this;c.prototype=this.prototype;b.prototype=new c;return b});
var gc=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,
0,0,1,1,0,1,0,0,1];t.cpu=2;t.bus=4;t.mem=8;t.port=16;t.nvr=32;t.chipset=64;t.keyboard=128;t.key=256;t.video=512;t.fdc=1024;t.disk=2048;t.serial=4096;t.speaker=8192;t.computer=16384;function hc(a){z.call(this,"Panel",a)}ta(hc,z);hc.prototype.ea=function(a,b,c,d){return this.S&&this.S.ea(a,b,c,d)||this.A&&this.A.ea(a,b,c,d)||this.D&&this.D.ea(a,b,c,d)||this.L&&this.L.ea(a,b,c,d)?!0:z.prototype.ea.call(this,a,b,c,d)};hc.prototype.Fa=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.L=d;this.D=ic(a,"Keyboard")};
hc.prototype.wa=function(a,b){b||jc();return!0};hc.prototype.va=function(){return!0};function jc(){for(var a=!1,b=Kb("pcx80","panel"),c=0;c<b.length;c++){var d=b[c],e=Lb(d),f=Nb(e.id);f||(a=!0,f=new hc(e));Jb(f,d);a&&Vb(f)}}vb(jc);
function kc(a,b,c){z.call(this,"Bus",a);this.A=b;this.L=c;this.N=a.busWidth||16;this.O=Math.pow(2,this.N);this.F=this.O-1|0;this.i=(this.N>>1)+2;10>this.i&&(this.i=10);15<this.i&&(this.i=15);this.B=1<<this.i;this.P=this.B>>2;this.j=this.B-1;this.K=this.O/this.B|0;this.I=this.K-1;this.C=[];this.D=[];this.G=this.H=!1;this.T=[];this.U=[];a=new lc;mc(a,this.L);this.g=Array(this.K);for(b=0;b<this.K;b++)this.g[b]=a;Vb(this)}ta(kc,z);kc.prototype.reset=function(){};
kc.prototype.wa=function(a,b){b||this.reset();return!0};function nc(a,b,c,d){for(var e=b,f=c,g=e>>>a.i;0<f&&g<a.g.length;){var h=a.g[g],k=g*a.B,m=a.B-(e-k);m>f&&(m=f);if(h&&h.size){if(h.type==d){if(e+f<=h.M)return h.ob+=h.M-e,h.M=e,!0;if(e>=h.M+h.ob){m=h.size-(e-k);m>f&&(m=f);h.ob=e-h.M+m;e=k+a.B;f-=m;g++;continue}}return oc(a,pc,e,f)}e=new lc(e,m,a.B,d);mc(e,a.L,h);a.g[g++]=e;e=k+a.B;f-=m}return 0>=f?(a.status("%dKb %s at 0x%04X",Math.floor(c/1024),qc[d],b),!0):oc(a,rc,b,c)}
function sc(a,b){return a.g[(b&a.F)>>>a.i].nb(b&a.j,b)}function tc(a,b){var c=b&a.j,d=(b&a.F)>>>a.i;return c!=a.j?a.g[d].Jc(c,b):a.g[d++].Ya(c,b)|a.g[d&a.I].Ya(0,b+1)<<8}function uc(a,b){var c=b&a.j,d=(b&a.F)>>>a.i;return c!=a.j?a.g[d].Mb(c,b):a.g[d++].nb(c,b)|a.g[d&a.I].nb(0,b+1)<<8}function Ec(a,b,c){a.g[(b&a.F)>>>a.i].pb(b&a.j,c&255,b)}function Fc(a,b,c){var d=b&a.j,e=(b&a.F)>>>a.i;d!=a.j?a.g[e].Mc(d,c&65535,b):(a.g[e++].$a(d,c&255,b),a.g[e&a.I].$a(0,c>>8&255,b+1))}
function Gc(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=c[e].bind(b);if(void 0!==h)for(var k=+e+d;k<=g;k++)void 0!==f.C[k]?x("Input port "+Ia(k)+" already registered"):f.C[k]=[h,!1]}}function Hc(a,b,c){for(var d=1,e=0,f=0;0<d;){var g=a.C[b],h=a.T[b]||1,k=1==h?255:2==h?65535:-1,m=k;void 0!==g?(g[0]&&(m=g[0](b,c),void 0===m?m=k:m&=k),a.L&&a.G!=g[1]&&Ic(a.L,b,m)):a.L&&(fc(a.L,a,b,null,c),a.G&&Ic(a.L,b,m));e|=m<<f;f+=h<<3;b+=h;d-=h}return e}
function Jc(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=c[e].bind(b);if(void 0!==h)for(var k=+e+d;k<=g;k++)void 0!==f.D[k]?x("Output port "+Ia(k)+" already registered"):f.D[k]=[h,!1]}}function Kc(a,b,c,d){for(var e=1,f=0;0<e;){var g=a.D[b],h=a.U[b]||1,k=1==h?255:2==h?65535:-1,m=(c>>>=f)&k;if(void 0!==g){if(g[0])g[0](b,m,d);a.L&&a.H!=g[1]&&Lc(a.L,b,m)}else a.L&&(fc(a.L,a,b,m,d),a.H&&Lc(a.L,b,m));f+=h<<3;b+=h;e-=h}}
function oc(a,b,c,d){a.u(1099511627776,"Memory block error (%d: %#x,%#x)\n",b,c,d);return!1}var pc=1,rc=2,Mc,Nc=new ArrayBuffer(2);(new DataView(Nc)).setUint16(0,256,!0);Mc=256===(new Uint16Array(Nc))[0];
function lc(a,b,c,d){this.id=Oc+=2;this.M=a;this.ob=b;this.size=c||0;this.type=d||Pc;this.i=d==Qc;mc(this);this.Ia=this.Fc=!1;c?(this.R=new ArrayBuffer(c),this.S=new DataView(this.R,0,c),this.g=new Uint8Array(this.R,0,c),this.j=new Uint16Array(this.R,0,c>>1),new Int32Array(this.R,0,c>>2),(a=Mc?Rc:Sc)||(a=Tc),Uc(this,a),Vc(this,a)):(a=Tc,Uc(this,a),Vc(this,a))}l=lc.prototype;l.save=function(){var a;var b=Array(this.size>>2);for(a=0;a<b.length;a++)b[a]=this.S.getInt32(a<<2,!0);return b};
l.restore=function(a){if(a&&this.size==a.length<<2){var b;for(b=0;b<a.length;b++)this.S.setInt32(b<<2,a[b],!0);return this.Ia=!0}return!1};function Uc(a,b,c){c&&a.A||(a.Ya=b[0]||a.Ic,a.Jc=b[2]||a.Kc);if(c||void 0===c)a.nb=b[0]||a.Ic,a.Mb=b[2]||a.Kc}function Vc(a,b,c){c&&a.J||(a.$a=!a.i&&b[1]||a.qb,a.Mc=!a.i&&b[3]||a.Rb);if(c||void 0===c)a.pb=b[1]||a.qb,a.Sb=b[3]||a.Rb}l.Pa=function(a,b){b?0===this.J++&&Vc(this,Wc,!1):0===this.A++&&Uc(this,Wc,!1)};
function Xc(a,b){b?0===--a.J&&(a.$a=a.i?a.qb:a.pb,a.Mc=a.i?a.Rb:a.Sb):0===--a.A&&(a.Ya=a.nb,a.Jc=a.Mb)}function mc(a,b,c){a.L=b;a.A=a.J=0;c&&((a.A=c.A)&&Uc(a,Wc,!1),(a.J=c.J)&&Vc(a,Wc,!1))}l.Ic=function(){this.L&&this.L.u(11,"attempt to read invalid block %#x\n",this.M);return 255};l.qb=function(a,b){this.L&&this.L.u(11,"attempt to write %#06x to invalid block %#x\n",b,this.M)};l.Kc=function(a,b){return this.Ya(a++,b++)|this.Ya(a,b)<<8};l.Rb=function(a,b,c){this.$a(a++,b&255,c++);this.$a(a,b>>8,c)};
l.fe=function(a,b){if(this.L&&null!=this.M){var c=this.L;Yc(c,this.M+a,1,c.O)&&Zc(c,!0)}return this.nb(a,b)};l.je=function(a,b){if(this.L&&null!=this.M){var c=this.L;Yc(c,this.M+a,2,c.O)&&Zc(c,!0)}return this.Mb(a,b)};l.re=function(a,b,c){if(this.L&&null!=this.M){var d=this.L;Yc(d,this.M+a,1,d.D)&&Zc(d,!0)}this.i?this.qb(a,b,c):this.pb(a,b,c)};l.ue=function(a,b,c){if(this.L&&null!=this.M){var d=this.L;Yc(d,this.M+a,2,d.D)&&Zc(d,!0)}this.i?this.qb(a,b,c):this.Sb(a,b,c)};l.ee=function(a){return this.g[a]};
l.ge=function(a){return this.g[a]};l.ie=function(a){return this.S.getUint16(a,!0)};l.ke=function(a){return a&1?this.g[a]|this.g[a+1]<<8:this.j[a>>1]};l.qe=function(a,b){this.g[a]=b;this.Ia=!0};l.se=function(a,b){this.g[a]=b;this.Ia=!0};l.te=function(a,b){this.S.setUint16(a,b,!0);this.Ia=!0};l.ve=function(a,b){a&1?(this.g[a]=b,this.g[a+1]=b>>8):this.j[a>>1]=b;this.Ia=!0};
var Pc=0,Qc=2,qc=["NONE","RAM","ROM","VID","H/W"],Oc=0,Tc=[],Wc=[lc.prototype.fe,lc.prototype.re,lc.prototype.je,lc.prototype.ue],Sc=[lc.prototype.ee,lc.prototype.qe,lc.prototype.ie,lc.prototype.te],Rc=[lc.prototype.ge,lc.prototype.se,lc.prototype.ke,lc.prototype.ve];
function $c(a,b){z.call(this,"CPU",a,2);var c=a.multiplier||1;this.Aa=a.cycles||b;this.U=c;this.Ua=Math.round(this.Aa/1E4)/100;this.aa=this.Ua*this.U;this.flags.la=!1;this.flags.Pb=!1;this.flags.jb=a.autoStart;this.flags.Dc=!1;this.flags.Xa=!1;this.xa=this.pa=0;this.za=a.csStart;this.oa=a.csInterval;this.ta=a.csStop;this.V=[];this.wb=this.tb.bind(this);Vb(this)}ta($c,z);l=$c.prototype;
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.L=d;for(b=0;b<ad.length;b++)(c=this.R[ad[b]])&&this.S.ea("",ad[b],c);this.X=ic(a,"ChipSet");a=bd(a,"autoStart");null!=a&&(this.flags.jb="true"==a?!0:"false"==a?!1:!!a);Vb(this)};l.reset=function(){};l.save=function(){return null};l.restore=function(){return!1};
l.wa=function(a,b){if(!b){if(a&&this.restore){cd(this);if(!this.restore(a))return!1;dd(this)}else this.reset();this.L?(a=this.L,a.u("Type ? for help with PCx80 Debugger commands\n"),ed(a),a.oa&&(b=a.oa,a.oa=null,fd(a,b))):this.ia("No debugger detected")}gd(this);return!0};l.va=function(a){return a?this.save():!0};l.jb=function(){return this.flags.jb||!this.L&&void 0===this.R.run?(this.tb(),!0):!1};l.Gc=function(){return 0};
function dd(a){void 0===a.za&&(a.za=0);void 0===a.oa&&(a.oa=-1);void 0===a.ta&&(a.ta=-1);a.flags.Xa=0<=a.za&&0<a.oa;a.flags.Xa&&(a.xa=0,a.pa=a.za-a.ma)}function hd(a,b){if(a.flags.Xa){var c=!1;a.xa=a.xa+a.Gc()|0;a.pa-=b;0>=a.pa&&(a.pa+=a.oa,c=!0);0<=a.ta&&a.ta<=id(a)&&(a.oa=a.ta=-1,dd(a),jd(a),c=!0);c&&a.ia(id(a)+" cycles: checksum="+w(a.xa))}}
l.ea=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.R[b]=c;a=!0;break;case "run":this.R[b]=c;c.onclick=function(){var e;if(e=d.S)if(e=d.S,e.flags.ka)e=!0;else{var f=null,g,h=Mb(e.id);for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ready);g++);if(g==h.length)for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ka);g++);g==h.length&&(f=e);x("The "+f.type+" component ("+f.id+") is not "+(f.flags.ready?"powered yet":"ready yet"+(f.yb?" (waiting for notification)":""))+".");e=!1}e&&(d.flags.la?
jd(d):d.tb())};a=!0;break;case "speed":this.R[b]=c;a=!0;break;case "setSpeed":this.R[b]=c,c.onclick=function(){kd(d,d.U<<1,!0)},c.textContent=this.aa.toFixed(2)+"Mhz",a=!0}return a};function ld(a,b,c){a.ma+=b;c&&(a.fa=a.g=0)}function md(a,b){var c=1;b&&1<a.U&&a.Z&&(c=a.Z/a.Ua);a.hb=Math.round(1E3/xd);a.Na=Math.floor(a.Aa/xd*c);b||(a.ua=a.Na);a.Wa=0}function id(a){return a.ma+a.Y+a.fa-a.g}function cd(a){a.Z=0;a.ib=0;a.ma=a.Y=a.fa=a.g=0;dd(a);kd(a,1)}
function kd(a,b,c){var d=!1;if(void 0!==b){.8>a.Z/a.aa?b=1:d=!0;a.U=b;b=a.Ua*a.U;if(a.aa!=b){a.aa=b;b=a.aa.toFixed(2)+"Mhz";var e=a.R.setSpeed;e&&(e.textContent=b);a.ia("target speed: "+b)}c&&a.S&&a.S.Za()}ld(a,a.Y);a.Y=0;a.W=Hb();a.ca=0;md(a);return d}function yd(a,b,c){var d=void 0===d?-1:d;var e=a.V.length;a.V.push([b,-1,d,c]);0<=d&&zd(a,e,d);return e}function zd(a,b,c){0<=b&&b<a.V.length&&(b=a.V[b],0>b[1]&&(c=a.Aa*a.U/1E3*c|0,a.flags.la&&(c+=Ad(a)),b[1]=c))}
function Ad(a,b){var c=a.fa-=a.g;a.g=0;b&&(a.fa=0);return c}
l.tb=function(a){if(Xb(this,!0)){if(!this.flags.la){kd(this);this.S&&this.S.start(this.W,id(this));this.flags.la=!0;this.flags.Pb=!0;this.X&&this.X.start();var b=this.R.run;b&&(b.textContent="Halt");this.S&&(Bd(this.S,!0),a&&this.S.Za(!0))}this.Wa>=this.Aa&&md(this,!0);this.Ea=0;this.Ma=Hb();this.ca&&(a=this.Ma-this.ca,a>this.hb&&(this.W+=a,this.W>this.Ma&&(this.W=this.Ma)));try{do{for(var c,d=this.flags.Xa?1:this.Na,e=this.V.length-1;0<=e;e--){var f=this.V[e];0>f[1]||d>f[1]&&(d=f[1])}c=d;this.Db(c);
c=Ad(this,!0);this.Ea+=c;this.Y+=c;hd(this,c);a=c;for(var g=this.V.length-1;0<=g;g--){var h=this.V[g];0>h[1]||(h[1]-=a,0>=h[1]&&(h[1]=-1,h[3](),0<=h[2]&&zd(this,g,h[2])))}this.ua-=c;if(0>=this.ua){this.ua+=this.Na;++this.ib>=Cd&&(this.S&&Bd(this.S),this.ib=0);break}}while(this.flags.la)}catch(k){jd(this);gd(this);this.S&&this.S.stop(Hb(),id(this));Xb(this,!1);Tb(this,k.stack||k.message);return}c=setTimeout;d=this.wb;this.ca=Hb();e=this.hb;this.Ea&&(e=Math.round(e*this.Ea/this.Na));e-=this.ca-this.Ma;
if(f=this.ca-this.W)this.Z=Math.round(this.Y/(10*f))/100,864E5<=f&&(this.ma=0,kd(this));if(0>e||this.Z<this.aa)-1E3>e&&(this.W-=e),e=0;this.Wa+=this.Ea;this.ca+=e;c(d,e)}else gd(this),this.S&&this.S.stop(Hb(),id(this))};l.Db=function(){return 0};function jd(a,b){Wb(a,!0);Ad(a);ld(a,a.Y);a.Y=0;if(a.flags.la){a.flags.la=!1;a.X&&a.X.stop();var c=a.R.run;c&&(c.textContent="Run")}a.flags.complete=b}function gd(a,b){if(a.S){for(var c=a.S,d=0;d<c.C.length;d++)Dd(c.C[d],b);Bd(a.S,b)}}
var xd=30,Cd=15,ad=["power","reset"];function Ed(a){var b=+a.model||8080;$c.call(this,a,1E6);this.model=b;this.eb=Fd;cd(this);this.flags.complete=this.flags.xd=!1;this.gb=0;this.La=[];this.fb=0;Gd(this)}ta(Ed,$c);function Hd(a,b){a.La.push(b)}l=Ed.prototype;l.reset=function(){this.flags.la&&jd(this);Gd(this);cd(this);this.flags.error=!1;$c.prototype.reset.call(this)};function Gd(a){a.i=0;a.B=0;a.C=0;a.D=0;a.F=0;a.G=0;a.H=0;a.N=0;B(a,a.fb);Id(a,0);a.T=0}function Jd(a,b){a.fb=b;B(a,b)}
l.Gc=function(){var a=this.i+this.B+this.C+this.D+this.F+this.G+this.H|0;return a=a+this.N+this.j+Kd(this)|0};
l.save=function(){var a=new Ld(this);a.set(0,[this.i,this.B,this.C,this.D,this.F,this.G,this.H,this.N,this.j,Kd(this)]);a.set(1,[this.T,this.ma,this.U]);for(var b=a.set,c=this.J,d=0,e=[],f=0;f<c.K;f++){var g=c.g[f];if(g.Ia||g.Fc){e[d++]=f;var h=d++;if(g=g.save()){for(var k=0,m=0,p=[];k<g.length;){for(var u=g[k],r=k+1;r<g.length&&g[r]===u;)r++;p[m++]=r-k;p[m++]=u;k=r}p.length<g.length&&(g=p)}e[h]=g}}b.call(a,2,e);return a.data()};
l.restore=function(a){var b=a[0];this.i=b[0];this.B=b[1];this.C=b[2];this.D=b[3];this.F=b[4];this.G=b[5];this.H=b[6];this.N=b[7]&65535;B(this,b[8]);Id(this,b[9]);b=a[1];this.T=b[0];this.ma=b[1];kd(this,b[3]);a:{b=this.J;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.P){var f=b.P,g=0;f=f?Array(f):[];for(var h=0;h<e.length-1;)for(var k=e[h++],m=e[h++];k--;)f[g++]=m;e=f}g=b.g[d];if(!g||!g.restore(e)){x("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
l.ea=function(a,b,c){switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.R[b]=c;this.gb++;a=!0;break;default:a=$c.prototype.ea.call(this,a,b,c)}return a};function Md(a){return a.B<<8|a.C}function Nd(a,b){a.B=b>>8&255;a.C=b&255}function Od(a){return a.D<<8|a.F}function Pd(a,b){a.D=b>>8&255;a.F=b&255}function C(a){return a.G<<8|a.H}
function Qd(a,b){a.G=b>>8&255;a.H=b&255}function B(a,b){a.j=b&65535}function Rd(a){return a.I&256?1:0}function Sd(a,b){a.I=a.I&255|b}function Td(a){return gc[a.K&255]?4:0}function Ud(a){return(a.K^a.P)&16?16:0}function Vd(a){return a.I&255?0:64}function Wd(a){return a.K&128?128:0}function Kd(a){return a.O&-214|Wd(a)|Vd(a)|Ud(a)|Td(a)|Rd(a)}function Id(a,b){a.I=a.K=a.P=0;b&1&&(a.I|=256);b&4||(a.K|=1);b&16&&(a.P|=16);b&64||(a.I|=255);b&128&&(a.K^=192);a.O=a.O&-726|b&512|2}
function Xd(a,b){a.P=a.i^b;return a.K=(a.I=a.i+b)&255}function Yd(a,b){a.P=a.i^b;return a.K=(a.I=a.i+b+(a.I&256?1:0))&255}function Zd(a,b){a.I=a.K=a.P=a.i&b;(a.i|b)&8&&(a.P^=16);return a.I}function $d(a,b){a.P=b^255;b=a.K=b+255&255;a.I=a.I&-256|b;return b}function ae(a,b){a.P=b;b=a.K=b+1&255;a.I=a.I&-256|b;return b}function be(a,b){return a.K=a.I=a.P=a.i|b}function ce(a,b){b^=255;a.P=a.i^b;return a.K=(a.I=a.i+b+1^256)&255}
function de(a,b){b^=255;a.P=a.i^b;return a.K=(a.I=a.i+b+(a.I&256?0:1)^256)&255}function ee(a,b){return a.K=a.I=a.P=a.i^b}function G(a,b){a=a.J;return a.g[(b&a.F)>>>a.i].Ya(b&a.j,b)}function fe(a,b,c){a=a.J;a.g[(b&a.F)>>>a.i].$a(b&a.j,c&255,b)}function H(a){var b=G(a,a.j);B(a,a.j+1);return b}function I(a){var b=tc(a.J,a.j);B(a,a.j+2);return b}function ge(a){var b=tc(a.J,a.N);a.N=a.N+2&65535;return b}function J(a,b){a.N=a.N-2&65535;Fc(a.J,a.N,b)}
function he(a){if(a.g&&a.T&255&&a.O&512){for(var b=0;8>b&&!(a.T&1<<b);b++);a.T&=~(0>b?255:1<<b);a.O&=-513;a.T&=-257;a.eb[199|b<<3].call(a)}return a.T&256?(Ad(a),!1):!0}function ie(a,b){a.T|=1<<b;a.O&512&&Ad(a)}function K(a,b,c,d){d=d||2;a.R[b]&&(void 0===c&&(Tb(a,"Value for "+b+" is invalid"),jd(a)),c=!a.flags.la||a.flags.Dc?w(c,d):"--------".substr(0,d),a.R[b].textContent!=c&&(a.R[b].textContent=c))}
l.Db=function(a){this.flags.complete=!0;var b=this.flags.xd=this.L&&je(this.L),c=a?this.flags.Pb?0:1:-1;this.flags.Pb=!1;this.fa=this.g=a;if(he(this)){do{if(b){if(ke(this.L,this.j,c)){jd(this);break}c=1}this.eb[H(this)].call(this)}while(0<this.g)}return this.flags.complete?this.fa-this.g:void 0===this.flags.complete?0:-1};vb(function(){for(var a=Kb("pcx80","cpu"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new Ed(d);Jb(d,c)}});function le(){this.g-=4}function me(){B(this,I(this));this.g-=10}
function ne(){B(this,ge(this));this.g-=10}function oe(){var a=I(this);J(this,this.j);B(this,a);this.g-=17}
var Fd=[le,function(){Nd(this,I(this));this.g-=10},function(){fe(this,Md(this),this.i);this.g-=7},function(){Nd(this,Md(this)+1);this.g-=5},function(){this.B=ae(this,this.B);this.g-=5},function(){this.B=$d(this,this.B);this.g-=5},function(){this.B=H(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|a>>8;Sd(this,a&256);this.g-=4},le,function(){var a;Qd(this,a=C(this)+Md(this));Sd(this,a>>8&256);this.g-=10},function(){this.i=G(this,Md(this));this.g-=7},function(){Nd(this,Md(this)-1);this.g-=
5},function(){this.C=ae(this,this.C);this.g-=5},function(){this.C=$d(this,this.C);this.g-=5},function(){this.C=H(this);this.g-=7},function(){var a=this.i<<8&256;this.i=(a|this.i)>>1;Sd(this,a);this.g-=4},le,function(){Pd(this,I(this));this.g-=10},function(){fe(this,Od(this),this.i);this.g-=7},function(){Pd(this,Od(this)+1);this.g-=5},function(){this.D=ae(this,this.D);this.g-=5},function(){this.D=$d(this,this.D);this.g-=5},function(){this.D=H(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|
Rd(this);Sd(this,a&256);this.g-=4},le,function(){var a;Qd(this,a=C(this)+Od(this));Sd(this,a>>8&256);this.g-=10},function(){this.i=G(this,Od(this));this.g-=7},function(){Pd(this,Od(this)-1);this.g-=5},function(){this.F=ae(this,this.F);this.g-=5},function(){this.F=$d(this,this.F);this.g-=5},function(){this.F=H(this);this.g-=7},function(){var a=this.i<<8;this.i=(Rd(this)<<8|this.i)>>1;Sd(this,a&256);this.g-=4},le,function(){Qd(this,I(this));this.g-=10},function(){var a=I(this);Fc(this.J,a,C(this));
this.g-=16},function(){Qd(this,C(this)+1);this.g-=5},function(){this.G=ae(this,this.G);this.g-=5},function(){this.G=$d(this,this.G);this.g-=5},function(){this.G=H(this);this.g-=7},function(){var a=0,b=Rd(this);if(Ud(this)||9<(this.i&15))a|=6;if(b||154<=this.i)a|=96,b=1;this.i=Xd(this,a);Sd(this,b?256:0);this.g-=4},le,function(){var a;Qd(this,a=C(this)+C(this));Sd(this,a>>8&256);this.g-=10},function(){var a=I(this);a=tc(this.J,a);Qd(this,a);this.g-=16},function(){Qd(this,C(this)-1);this.g-=5},function(){this.H=
ae(this,this.H);this.g-=5},function(){this.H=$d(this,this.H);this.g-=5},function(){this.H=H(this);this.g-=7},function(){this.i=~this.i&255;this.g-=4},le,function(){this.N=I(this)&65535;this.g-=10},function(){fe(this,I(this),this.i);this.g-=13},function(){this.N=this.N+1&65535;this.g-=5},function(){var a=C(this);fe(this,a,ae(this,G(this,a)));this.g-=10},function(){var a=C(this);fe(this,a,$d(this,G(this,a)));this.g-=10},function(){fe(this,C(this),H(this));this.g-=10},function(){this.I|=256;this.g-=
4},le,function(){var a;Qd(this,a=C(this)+this.N);Sd(this,a>>8&256);this.g-=10},function(){this.i=G(this,I(this));this.g-=13},function(){this.N=this.N-1&65535;this.g-=5},function(){this.i=ae(this,this.i);this.g-=5},function(){this.i=$d(this,this.i);this.g-=5},function(){this.i=H(this);this.g-=7},function(){Sd(this,Rd(this)?0:256);this.g-=4},function(){this.g-=5},function(){this.B=this.C;this.g-=5},function(){this.B=this.D;this.g-=5},function(){this.B=this.F;this.g-=5},function(){this.B=this.G;this.g-=
5},function(){this.B=this.H;this.g-=5},function(){this.B=G(this,C(this));this.g-=7},function(){this.B=this.i;this.g-=5},function(){this.C=this.B;this.g-=5},function(){this.g-=5},function(){this.C=this.D;this.g-=5},function(){this.C=this.F;this.g-=5},function(){this.C=this.G;this.g-=5},function(){this.C=this.H;this.g-=5},function(){this.C=G(this,C(this));this.g-=7},function(){this.C=this.i;this.g-=5},function(){this.D=this.B;this.g-=5},function(){this.D=this.C;this.g-=5},function(){this.g-=5},function(){this.D=
this.F;this.g-=5},function(){this.D=this.G;this.g-=5},function(){this.D=this.H;this.g-=5},function(){this.D=G(this,C(this));this.g-=7},function(){this.D=this.i;this.g-=5},function(){this.F=this.B;this.g-=5},function(){this.F=this.C;this.g-=5},function(){this.F=this.D;this.g-=5},function(){this.g-=5},function(){this.F=this.G;this.g-=5},function(){this.F=this.H;this.g-=5},function(){this.F=G(this,C(this));this.g-=7},function(){this.F=this.i;this.g-=5},function(){this.G=this.B;this.g-=5},function(){this.G=
this.C;this.g-=5},function(){this.G=this.D;this.g-=5},function(){this.G=this.F;this.g-=5},function(){this.g-=5},function(){this.G=this.H;this.g-=5},function(){this.G=G(this,C(this));this.g-=7},function(){this.G=this.i;this.g-=5},function(){this.H=this.B;this.g-=5},function(){this.H=this.C;this.g-=5},function(){this.H=this.D;this.g-=5},function(){this.H=this.F;this.g-=5},function(){this.H=this.G;this.g-=5},function(){this.g-=5},function(){this.H=G(this,C(this));this.g-=7},function(){this.H=this.i;
this.g-=5},function(){fe(this,C(this),this.B);this.g-=7},function(){fe(this,C(this),this.C);this.g-=7},function(){fe(this,C(this),this.D);this.g-=7},function(){fe(this,C(this),this.F);this.g-=7},function(){fe(this,C(this),this.G);this.g-=7},function(){fe(this,C(this),this.H);this.g-=7},function(){var a=this.j-1;if(this.La.length)for(var b=0;b<this.La.length;b++)if(this.La[b](a))return;this.g-=7;this.T|=256;Ad(this);this.L&&Zb(this,70368744177664)?(B(this,a),Zc(this.L)):this.O&512||(this.L&&B(this,
a),jd(this))},function(){fe(this,C(this),this.i);this.g-=7},function(){this.i=this.B;this.g-=5},function(){this.i=this.C;this.g-=5},function(){this.i=this.D;this.g-=5},function(){this.i=this.F;this.g-=5},function(){this.i=this.G;this.g-=5},function(){this.i=this.H;this.g-=5},function(){this.i=G(this,C(this));this.g-=7},function(){this.g-=5},function(){this.i=Xd(this,this.B);this.g-=4},function(){this.i=Xd(this,this.C);this.g-=4},function(){this.i=Xd(this,this.D);this.g-=4},function(){this.i=Xd(this,
this.F);this.g-=4},function(){this.i=Xd(this,this.G);this.g-=4},function(){this.i=Xd(this,this.H);this.g-=4},function(){this.i=Xd(this,G(this,C(this)));this.g-=7},function(){this.i=Xd(this,this.i);this.g-=4},function(){this.i=Yd(this,this.B);this.g-=4},function(){this.i=Yd(this,this.C);this.g-=4},function(){this.i=Yd(this,this.D);this.g-=4},function(){this.i=Yd(this,this.F);this.g-=4},function(){this.i=Yd(this,this.G);this.g-=4},function(){this.i=Yd(this,this.H);this.g-=4},function(){this.i=Yd(this,
G(this,C(this)));this.g-=7},function(){this.i=Yd(this,this.i);this.g-=4},function(){this.i=ce(this,this.B);this.g-=4},function(){this.i=ce(this,this.C);this.g-=4},function(){this.i=ce(this,this.D);this.g-=4},function(){this.i=ce(this,this.F);this.g-=4},function(){this.i=ce(this,this.G);this.g-=4},function(){this.i=ce(this,this.H);this.g-=4},function(){this.i=ce(this,G(this,C(this)));this.g-=7},function(){this.i=ce(this,this.i);this.g-=4},function(){this.i=de(this,this.B);this.g-=4},function(){this.i=
de(this,this.C);this.g-=4},function(){this.i=de(this,this.D);this.g-=4},function(){this.i=de(this,this.F);this.g-=4},function(){this.i=de(this,this.G);this.g-=4},function(){this.i=de(this,this.H);this.g-=4},function(){this.i=de(this,G(this,C(this)));this.g-=7},function(){this.i=de(this,this.i);this.g-=4},function(){this.i=Zd(this,this.B);this.g-=4},function(){this.i=Zd(this,this.C);this.g-=4},function(){this.i=Zd(this,this.D);this.g-=4},function(){this.i=Zd(this,this.F);this.g-=4},function(){this.i=
Zd(this,this.G);this.g-=4},function(){this.i=Zd(this,this.H);this.g-=4},function(){this.i=Zd(this,G(this,C(this)));this.g-=7},function(){this.i=Zd(this,this.i);this.g-=4},function(){this.i=ee(this,this.B);this.g-=4},function(){this.i=ee(this,this.C);this.g-=4},function(){this.i=ee(this,this.D);this.g-=4},function(){this.i=ee(this,this.F);this.g-=4},function(){this.i=ee(this,this.G);this.g-=4},function(){this.i=ee(this,this.H);this.g-=4},function(){this.i=ee(this,G(this,C(this)));this.g-=7},function(){this.i=
ee(this,this.i);this.g-=4},function(){this.i=be(this,this.B);this.g-=4},function(){this.i=be(this,this.C);this.g-=4},function(){this.i=be(this,this.D);this.g-=4},function(){this.i=be(this,this.F);this.g-=4},function(){this.i=be(this,this.G);this.g-=4},function(){this.i=be(this,this.H);this.g-=4},function(){this.i=be(this,G(this,C(this)));this.g-=7},function(){this.i=be(this,this.i);this.g-=4},function(){ce(this,this.B);this.g-=4},function(){ce(this,this.C);this.g-=4},function(){ce(this,this.D);this.g-=
4},function(){ce(this,this.F);this.g-=4},function(){ce(this,this.G);this.g-=4},function(){ce(this,this.H);this.g-=4},function(){ce(this,G(this,C(this)));this.g-=7},function(){ce(this,this.i);this.g-=4},function(){Vd(this)||(B(this,ge(this)),this.g-=6);this.g-=5},function(){Nd(this,ge(this));this.g-=10},function(){var a=I(this);Vd(this)||B(this,a);this.g-=10},me,function(){var a=I(this);Vd(this)||(J(this,this.j),B(this,a),this.g-=6);this.g-=11},function(){J(this,Md(this));this.g-=11},function(){this.i=
Xd(this,H(this));this.g-=7},function(){J(this,this.j);B(this,0);this.g-=11},function(){Vd(this)&&(B(this,ge(this)),this.g-=6);this.g-=5},ne,function(){var a=I(this);Vd(this)&&B(this,a);this.g-=10},me,function(){var a=I(this);Vd(this)&&(J(this,this.j),B(this,a),this.g-=6);this.g-=11},oe,function(){this.i=Yd(this,H(this));this.g-=7},function(){J(this,this.j);B(this,8);this.g-=11},function(){Rd(this)||(B(this,ge(this)),this.g-=6);this.g-=5},function(){Pd(this,ge(this));this.g-=10},function(){var a=I(this);
Rd(this)||B(this,a);this.g-=10},function(){var a=H(this);Kc(this.J,a,this.i,this.j+-2&65535);this.g-=10},function(){var a=I(this);Rd(this)||(J(this,this.j),B(this,a),this.g-=6);this.g-=11},function(){J(this,Od(this));this.g-=11},function(){this.i=ce(this,H(this));this.g-=7},function(){J(this,this.j);B(this,16);this.g-=11},function(){Rd(this)&&(B(this,ge(this)),this.g-=6);this.g-=5},ne,function(){var a=I(this);Rd(this)&&B(this,a);this.g-=10},function(){var a=H(this);this.i=Hc(this.J,a,this.j+-2&65535)&
255;this.g-=10},function(){var a=I(this);Rd(this)&&(J(this,this.j),B(this,a),this.g-=6);this.g-=11},oe,function(){this.i=de(this,H(this));this.g-=7},function(){J(this,this.j);B(this,24);this.g-=11},function(){Td(this)||(B(this,ge(this)),this.g-=6);this.g-=5},function(){Qd(this,ge(this));this.g-=10},function(){var a=I(this);Td(this)||B(this,a);this.g-=10},function(){var a=ge(this);J(this,C(this));Qd(this,a);this.g-=18},function(){var a=I(this);Td(this)||(J(this,this.j),B(this,a),this.g-=6);this.g-=
11},function(){J(this,C(this));this.g-=11},function(){this.i=Zd(this,H(this));this.g-=7},function(){J(this,this.j);B(this,32);this.g-=11},function(){Td(this)&&(B(this,ge(this)),this.g-=6);this.g-=5},function(){B(this,C(this));this.g-=5},function(){var a=I(this);Td(this)&&B(this,a);this.g-=10},function(){var a=C(this);Qd(this,Od(this));Pd(this,a);this.g-=5},function(){var a=I(this);Td(this)&&(J(this,this.j),B(this,a),this.g-=6);this.g-=11},oe,function(){this.i=ee(this,H(this));this.g-=7},function(){J(this,
this.j);B(this,40);this.g-=11},function(){Wd(this)||(B(this,ge(this)),this.g-=6);this.g-=5},function(){var a=ge(this);Id(this,a&255|this.O&-256);this.i=a>>8;this.g-=10},function(){var a=I(this);Wd(this)||B(this,a);this.g-=10},function(){this.O&=-513;this.g-=4},function(){var a=I(this);Wd(this)||(J(this,this.j),B(this,a),this.g-=6);this.g-=11},function(){J(this,Kd(this)&255|this.i<<8);this.g-=11},function(){this.i=be(this,H(this));this.g-=7},function(){J(this,this.j);B(this,48);this.g-=11},function(){Wd(this)&&
(B(this,ge(this)),this.g-=6);this.g-=5},function(){this.N=C(this)&65535;this.g-=5},function(){var a=I(this);Wd(this)&&B(this,a);this.g-=10},function(){this.O|=512;this.g-=4;he(this)},function(){var a=I(this);Wd(this)&&(J(this,this.j),B(this,a),this.g-=6);this.g-=11},oe,function(){ce(this,H(this));this.g-=7},function(){J(this,this.j);B(this,56);this.g-=11}];
function pe(a){z.call(this,"ChipSet",a,64);var b=a.model;b&&!qe[b]&&yb("Unrecognized ChipSet model: "+b);this.i=qe[b]||{};a.sound&&(this.V=null,(this.V=n.AudioContext||n.webkitAudioContext)&&new this.V);Vb(this)}ta(pe,z);l=pe.prototype;l.ea=function(){return!1};
l.Fa=function(a,b,c,d){this.J=b;this.A=c;this.L=d;this.S=a;this.D=ic(a,"Keyboard");this.F=ic(a,"SerialPort");this.video=ic(a,"Video");Gc(b,this,this.i.Ab);Jc(b,this,this.i.Bb);if(d){var e=this;re(d,32,function(){for(var f="",g=0;g<e.j.length;g++)f&&(f+=g&&g%10?", ":",\n"),f+=Ia(e.j[g]);e.L.ia(f)})}};l.wa=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};l.va=function(a){return a?this.save():!0};l.reset=function(){this.i.INIT&&!this.restore(this.i.INIT)&&this.ba("reset error")};
l.save=function(){var a=new Ld(this);switch(this.i.qa){case Oe.qa:a.set(0,[this.ca,this.C,this.fa,this.O,this.U,this.Z,this.aa]);break;case L.qa:a.set(0,[this.X,this.G]),a.set(1,[this.H,this.I]),a.set(2,[this.B,this.P,this.Y,this.W]),a.set(3,[this.N,this.g,this.K,this.T,this.j])}return a.data()};
l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.i.qa){case Oe.qa:return this.ca=b[0],this.C=b[1],this.fa=b[2],this.O=b[3],this.U=b[4],this.Z=b[5],this.aa=b[6],!0;case L.qa:return this.X=b[0],this.G=b[1],b=a[1],this.H=b[0],this.I=b[1],b=a[2],this.B=b[0],this.P=b[1],this.Y=b[2],this.W=b[3],b=a[3],this.N=b[0],this.g=b[1],this.K=b[2],this.T=b[3],this.j=b[4],!0}return!1};l.start=function(){};l.stop=function(){};l.Id=function(a,b){var c=this.ca;A(this,a,void 0,b,"STATUS0",c,!0);return c};
l.Jd=function(a,b){var c=this.C;A(this,a,void 0,b,"STATUS1",c,!0);return c};l.Kd=function(a,b){var c=this.fa;A(this,a,void 0,b,"STATUS2",c,!0);return c};l.Hd=function(a,b){var c=this.O>>8-this.U&255;A(this,a,void 0,b,"SHIFT.RESULT",c,!0);return c};l.Vd=function(a,b,c){A(this,a,b,c,"SHIFT.COUNT",void 0,!0);this.U=b};l.Xd=function(a,b,c){A(this,a,b,c,"SOUND1",void 0,!0);this.Z=b};l.Wd=function(a,b,c){A(this,a,b,c,"SHIFT.DATA",void 0,!0);this.O=b<<8|this.O>>8};
l.Yd=function(a,b,c){A(this,a,b,c,"SOUND2",void 0,!0);this.aa=b};l.Zd=function(a,b,c){A(this,a,b,c,"WATCHDOG",void 0,!0)};function Pe(a){var b=0,c=0,d=~a.N;for(a=0;10>a;a++)d&1&&(b=9-a),d>>=1;for(a=0;10>a;a++)d&1&&(c=9-a),d>>=1;return 10*b+c}
l.Ld=function(a,b){var c=this.G;c&=~L.ya.lc;if((id(this.A)&64)<<1&&(c|=L.ya.lc,c!=this.G)){var d=this.K&1;var e=this.K>>1&7;switch(e){case L.Ba.Ja.pd:break;case L.Ba.Ja.Nc:this.N=this.N<<1|d;break;case L.Ba.Ja.Sc:d=Pe(this);this.j[d]=L.Ba.ub;ec(this,"doNVRCommand(): erase data at addr "+Ia(d));break;case L.Ba.Ja.Oc:this.g=this.g<<1|d;break;case L.Ba.Ja.td:d=Pe(this);e=this.g&L.Ba.ub;this.j[d]=e;ec(this,"doNVRCommand(): write data "+Ia(e)+" to addr "+Ia(d));break;case L.Ba.Ja.nd:d=Pe(this);e=this.j[d];
null==e&&(e=L.Ba.ub);this.g=e;ec(this,"doNVRCommand():  read data "+Ia(e)+" from addr "+Ia(d));break;case L.Ba.Ja.od:this.g<<=1;this.T=this.g&L.Ba.ub+1;break;default:ec(this,"doNVRCommand(): unrecognized command "+w(e,2,!0))}}c&=~L.ya.mc;this.T&&(c|=L.ya.mc);c&=~L.ya.ec;if(d=this.D){d=this.D;if(e=d.C)e=d.A,e=id(d.A)>=d.H+(e.Aa*e.U/1E3*1.2731488|0);e&&(d.C=!1);d=!d.C}d&&(c|=L.ya.ec);c&=~L.ya.uc;this.F&&this.F.ja&Qe&&(c|=L.ya.uc);this.G=c;A(this,a,void 0,b,"FLAGS",c);return c};
l.$d=function(a,b,c){A(this,a,b,c,"BRIGHTNESS");this.X=b};l.ce=function(a,b,c){A(this,a,b,c,"NVR.LATCH");this.K=b};l.be=function(a,b,c){A(this,a,b,c,"DC012");a=b&3;switch(b>>2&3){case 0:this.B=this.B&-4|a;break;case 1:this.B=this.B&-13|a<<2;this.video&&(b=this.video,a=this.B,ec(b,"updateScrollOffset("+a+")"),b.ta!==a&&((b.ta=a)?Dd(b,!0):b.xa=!0));break;case 2:switch(a){case 0:this.P=~this.P;break;case 2:case 3:this.Y=3-a}break;case 3:this.W=a}};
l.ae=function(a,b,c){A(this,a,b,c,"DC011");b&L.Ka.md?(b&=L.Ka.qc,this.I!=b&&(this.I=b,this.video&&(a=this.video,b=this.I==L.Ka.qc?50:60,ec(a,"updateRate("+b+")"),a.ib=b))):(b&=L.Ka.Xb,this.H!=b&&(this.H=b,this.video&&(a=this.H==L.Ka.Xb?132:80,b=this.video,ec(b,"updateDimensions("+a+","+(80<a&&this.G&L.ya.kc?14:24)+")"),b.P=a,b.ha=b.Ea,80<a&&b.ha--,Re(b)&&Se(b))))};
var Oe={qa:1978.1,rd:{ra:0,bf:1,gf:16,pf:32,yf:64,xf:128,bb:14},Oa:{ra:1,Rc:1,ld:2,gd:4,hd:16,jd:32,kd:64,bb:8},sd:{ra:2,af:3,Gf:4,cf:8,tf:16,uf:32,vf:64,df:128,bb:0},Cf:{ra:3},Af:{ra:2,qf:7},Ef:{ra:3,Hf:1,Df:2,wf:4,mf:8,ff:16,we:32},Bf:{ra:4},Ff:{ra:5,hf:1,jf:2,kf:4,lf:8,If:16}},L={qa:100,ya:{ra:66,uc:1,kc:2,fd:4,sf:8,rf:16,mc:32,lc:64,ec:128},Qc:{ra:66,INIT:0},Ka:{ra:194,ze:0,Xb:16,md:32,qc:48,Vc:0,Wc:32},sb:{ra:162,zf:0,Yc:0,Uc:0,Xc:0,Tc:0},Ba:{nf:{ra:98},Ja:{Oc:0,Nc:1,od:2,td:4,Sc:5,nd:6,pd:7},
ub:16383}},qe={SI1978:Oe,VT100:L};Oe.INIT=[[Oe.rd.bb,Oe.Oa.bb,Oe.sd.bb,0,0,0,0]];
L.INIT=[[L.Qc.INIT,L.ya.kc|L.ya.fd],[L.Ka.Vc,L.Ka.Wc],[L.sb.Yc,L.sb.Uc,L.sb.Xc,L.sb.Tc],[0,0,0,0,[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11984,11888,11776,11808,11776,12E3,12E3,11901,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11808,11984,11856,11776,11808,11776,12E3,12E3,11881,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]];Oe.Ab={0:pe.prototype.Id,1:pe.prototype.Jd,2:pe.prototype.Kd,3:pe.prototype.Hd};
Oe.Bb={2:pe.prototype.Vd,3:pe.prototype.Xd,4:pe.prototype.Wd,5:pe.prototype.Yd,6:pe.prototype.Zd};L.Ab={66:pe.prototype.Ld};L.Bb={66:pe.prototype.$d,98:pe.prototype.ce,162:pe.prototype.be,194:pe.prototype.ae};vb(function(){for(var a=Kb("pcx80","chipset"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new pe(d);Jb(d,c)}});
function Te(a){z.call(this,"ROM",a);this.g=null;this.C=a.addr;this.i=a.size;this.B=a.alias;this.j=a.file;this.D=Ja(this.j);if(this.j){a=this.j;var b=Ka(this.D);"json"!=b&&"hex"!=b&&(a=bb()+"/api/v1/dump?file="+this.j+"&format=bytes&decimal=true");var c=this;$a(a,null,!0,function(d,e,f){Ue(c,d,e,f)})}}ta(Te,z);Te.prototype.Fa=function(a,b,c,d){this.J=b;this.A=c;this.L=d;Ve(this)};
Te.prototype.wa=function(){if(this.sa){if(this.L){var a=this.L,b=this.id,c=this.C,d=this.i,e=this.sa,f=[],g;for(g in e){var h=e[g];"number"==typeof h&&(e[g]=h={o:h});var k=h.o,m=h.a;if(void 0!==k){var p=f;k=[k>>>0,g];var u=Ya(p,k,a.Cc);0>u&&p.splice(-(u+1),0,k)}m&&(h.a=m.replace(/''/g,'"'))}a.F.push({Lf:b,M:c,Pd:d,sa:e,Ac:f})}delete this.sa}return!0};Te.prototype.va=function(){return!0};
function Ue(a,b,c,d){if(d)a.ba("Unable to load system ROM (error "+d+": "+b+")");else{Gb(a.Sa,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,g=e.longs||e.data;if(f)a.g=f;else if(g)for(a.g=Array(4*g.length),d=c=0;c<g.length;c++)a.g[d++]=g[c]&255,a.g[d++]=g[c]>>8&255,a.g[d++]=g[c]>>16&255,a.g[d++]=g[c]>>24&255;else a.g=e;a.sa=e.symbols;if(!a.g.length){x("Empty ROM: "+b);return}if(1==a.g.length){x(a.g[0]);return}}catch(h){a.ba("ROM data error: "+h.message);return}else for(b=
c.replace(/\n/gm," ").replace(/ +$/,"").split(" "),a.g=Array(b.length),e=0;e<b.length;e++)a.g[e]=Ea(b[e],16);Ve(a)}}
function Ve(a){if(!Ub(a))if(!a.j)Vb(a);else if(a.g&&a.J){a.i||(a.i=a.g.length);if(a.g.length!=a.i)Tb(a,"ROM size ("+w(a.g.length,8,!0)+") does not match specified size ("+w(a.i,8,!0)+")");else{var b=a.C;if(nc(a.J,b,a.i,Qc)){var c;for(c=0;c<a.g.length;c++)Ec(a.J,b+c,a.g[c]);b=!0}else b=!1;if(b){b=[];"number"==typeof a.B?b.push(a.B):null!=a.B&&a.B.length&&(b=a.B);for(c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.J,g=d.i,h=[],k=d.C>>>f.i;0<g&&k<f.g.length;)h.push(f.g[k++]),g-=f.B;f=d.J;d=d.i;g=0;for(e>>>=
f.i;0<d&&e<f.g.length;){k=h[g++];if(!k)break;f.g[e++]=k;d-=f.B}}delete a.g}}Vb(a)}}vb(function(){for(var a=Kb("pcx80","rom"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new Te(d);Jb(d,c)}});
function We(a){z.call(this,"RAM",a);this.sa=this.i=null;this.B=a.addr;this.C=a.size;this.Qa=a.load;this.Ha=a.exec;this.j=!1;this.g=a.file;this.D=Ja(this.g);if(this.g){a=this.g;var b=Ka(this.D);"json"!=b&&"hex"!=b&&(a=bb()+"/api/v1/dump?file="+this.g+"&format=bytes&decimal=true");var c=this;$a(a,null,!0,function(d,e,f){f?c.ba("Unable to load RAM resource (error "+f+": "+d+")"):(Gb(c.Sa,d,e),(d=cb(d,e))?(c.i=d.na,c.sa=d.sa,null==c.Qa&&(c.Qa=d.Qa),null==c.Ha&&(c.Ha=d.Ha)):c.g=null,Xe(c))})}}ta(We,z);
We.prototype.Fa=function(a,b,c,d){this.J=b;this.A=c;this.L=d;Xe(this)};We.prototype.wa=function(){return!0};We.prototype.va=function(){return!0};
function Xe(a){!a.j&&a.C&&nc(a.J,a.B,a.C,1)&&(a.j=!0);if(!Ub(a)){if(!a.j)x("No RAM allocated");else if(a.g){if(!a.i||!a.J)return;var b=a.B;null!==a.Qa&&(b=a.Qa);for(var c=0;c<a.i.length;c++)Ec(a.J,b+c,a.i[c]);if(null!==a.Ha){if(a.Ha==Ye){for(c=0;c<Ze.length;c++)Ec(a.J,Ze[c],118);Hd(a.A,function(d){return function(e){if(0<=Ze.indexOf(e)){var f=!1,g=d.A,h=d.L;if(e==$e)switch(f=!0,g.C){case af:d.print(String.fromCharCode(g.F).replace(/\r/g,""));break;case bf:for(var k=Od(g),m="",p=255;p--;){var u=G(d.A,
k++);if(36==u)break;m+=String.fromCharCode(u)}d.print(m.replace(/\r/g,""));break;default:f=!1}f?ne.call(g):h&&(d.ia("\nCP/M vector "+Ia(e)),B(g,e),Zc(h));e=!0}else e=!1;return e}}(a))}Jd(a.A,a.Ha)}delete a.i}Vb(a)}}We.prototype.reset=function(){};var $e=5,af=2,bf=9,Ye=256,Ze=[0,$e];vb(function(){for(var a=Kb("pcx80","ram"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new We(d);Jb(d,c)}});
function cf(a){z.call(this,"Keyboard",a,128);(a=a.model)&&!df[a]&&yb("Unrecognized KeyboardX80 model: "+a);this.g=df[a]||{};this.reset();Vb(this)}ta(cf,z);l=cf.prototype;
l.ea=function(a,b,c){var d=this,e=a+"-"+b;if(void 0===this.R[e]){if("led"==a&&this.g.cb[b])return this.R[e]=c,!0;switch(b){case "kbd":case "screen":return mb("iOS")?(c.onkeypress=function(f){var g=!1;if(f=d.g.rb[f.keyCode||f.charCode]){f&128&&(f&=127,g=!0);a:{for(h in d.g.Ta)if(d.g.Ta[h]==f){var h=+h;break a}h=0}h&&(g?ef(d,16,!0,!0):ef(d,16,!1),ef(d,h,!0,!0))}return!0},c.onkeydown=function(f){return ff(d,f,!0)},c.onkeyup=function(f){return ff(d,f,!1)}):(c.onkeydown=function(f){return gf(d,f,!0)},
c.onkeyup=function(f){return gf(d,f,!1)},c.onkeypress=function(f){f=f.keyCode||f.charCode;f>=v.ab&&f<=v.vb?d.i&(hf|jf)||(d.i|=jf,ef(d,20,!0),kf(d)):f>=v.a&&f<=v.z&&d.i&jf&&(d.i&=~jf,ef(d,20,!1),kf(d));return!0}),c.onpaste=function(f){a:{if(d.F&&d.F.Ra&&(f.stopPropagation&&f.stopPropagation(),f.preventDefault&&f.preventDefault(),f=f.clipboardData||n.clipboardData)){lf(d.F,f.getData("Text"));f=!1;break a}f=!0}return f},!0;default:if(this.g.Va&&void 0!==this.g.Va[b])return this.R[e]=c,c.onclick=function(f,
g){return function(h){h.preventDefault&&h.preventDefault();h=!0;var k=0;17==g?k=mf:20==g&&(k=jf);if(k){c.style.fontWeight="normal";if(h=!(f.i&k))c.style.fontWeight="bold";nf(f,g,h)}ef(f,g,h,!k);f.S&&f.S.Za()}}(this,this.g.Va[b]),!0}}return!1};l.Fa=function(a,b,c,d){this.S=a;this.A=c;this.L=d;var e=this;this.K=yd(this.A,this.id,function(){of(e)});this.X=ic(a,"ChipSet");this.F=ic(a,"SerialPort");Gc(b,this,this.g.Ab);Jc(b,this,this.g.Bb)};
l.wa=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};l.va=function(a){return a?this.save():!0};l.reset=function(){this.j=[];this.i=0;this.g.INIT&&!this.restore(this.g.INIT)&&this.ba("reset error")};l.save=function(){var a=new Ld(this);switch(this.g.qa){case M.qa:a.set(0,[this.G,this.D,this.C,this.H,-1])}return a.data()};
l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.g.qa){case pf.qa:return!0;case M.qa:return this.G=b[0],kf(this,this.G&M.Ca.fc),this.D=b[1],this.C=b[2],this.H=b[3],this.B=b[4],!0}return!1};function kf(a,b){null!=b?a.I=b:b=a.I;for(var c in a.g.cb){var d="led-"+c;if(d=a.R[d]){var e=a.g.cb[c],f=!!(b&e);e&e-1&&(f=!(b&~e));d.style.backgroundColor=f?"#"+w(16711680,6):"#000000"}}if(d=a.R["led-caps-lock"])d.style.backgroundColor=a.i&jf?"#"+w(65280,6):"#000000"}
function nf(a,b,c,d){var e=0;switch(b){case 16:e=d?qf:rf;break;case 17:e=d?sf:mf;break;case 18:e=d?tf:uf;break;case 91:e=d?vf:wf;break;case 20:e=jf,c=!(a.i&e)}e&&(a.i=c?a.i|e:a.i&~e);return c}
function gf(a,b,c){var d=!0,e=b.keyCode;e=Ba[e]||e;c=nf(a,e,c,2==b.location);a:if(e=a.g.Ub[e]||e,a.g.Ta[e])var f=e;else{for(f in a.g.Va)if(a.g.Va[f]===e)break a;f=null}f&&!b.metaKey&&(d=!1,a.i&(xf|yf)&&(13==f?(f=118,d=!0):8==f&&(f=46,d=!0),d&&(a.i=c?a.i|yf:a.i&~yf)),d=ef(a,f,c),(!(f>=v.ab&&f<=v.vb)||a.i|zf)&&b.preventDefault&&b.preventDefault());return d}
function ff(a,b,c){var d=!0;if(c){var e=b.keyCode,f=a.g.Ta[e],g;if(g=f){a:{for(var h in a.g.rb)if(a.g.rb[h]==f){f=+h;break a}f=0}g=!f}g&&(d=ef(a,e,c,!0),b.preventDefault&&b.preventDefault())}return d}
function ef(a,b,c,d){var e;a:{for(e=0;e<a.j.length;e++)if(a.j[e].Ob==b)break a;e=-1}if(c)0>e?a.j.push({Ob:b,Lb:Date.now(),xb:d||!1}):(a.j[e].Lb=Date.now(),a.j[e].xb=d||!1),d&&of(a);else if(0<=e){if(!a.j[e].xb&&(d=a.j[e].Lb)&&Date.now()-d<Af)return a.j[e].xb=!0,of(a),!0;a.j.splice(e,1)}if(a.X){d=0;switch(b){case "1p":d=Oe.Oa.gd;break;case "2p":d=Oe.Oa.ld;break;case "coin":d=Oe.Oa.Rc;break;case "left":d=Oe.Oa.jd;break;case "right":d=Oe.Oa.kd;break;case "fire":d=Oe.Oa.hd}d&&(a=a.X,b=d,a.C&=~b,c&&(a.C|=
b))}return!0}function of(a){for(var b=0,c=-1;b<a.j.length;){if(a.j[b].xb){var d=a.j[b].Ob,e=Af-(Date.now()-a.j[b].Lb);if(0<e){if(0>c||c>e)c=e}else{ef(a,d,!1);b=0;continue}}b++}0<=c&&zd(a.A,a.K,c)}l.Md=function(a,b){var c=this.D;0<=this.B&&(this.B<this.j.length?(c=this.j[this.B],this.B++,c=M.Ta[c.Ob],c&128&&(c&=127)):(this.B=-1,c=M.$c),this.D=c,ie(this.A,1));A(this,a,void 0,b,"KBDUART.ADDRESS",c);return c};
l.de=function(a,b,c){A(this,a,b,c,"KBDUART.STATUS");this.G=b;this.C=!0;this.H=id(this.A);kf(this,b&M.Ca.fc);b&M.Ca.qd&&(this.B=0,ie(this.A,1))};var qf=1,rf=2,hf=3,sf=4,mf=8,zf=12,tf=16,uf=32,xf=48,vf=64,wf=128,jf=512,yf=4096,Af=50,Bf={};Bf[v.ab]=37;Bf[v.Cb]=39;Bf[v.Fb]=32;
var pf={qa:1978.1,Ta:{},rb:{},Ub:Bf,cb:{},Va:{"1p":49,"2p":50,coin:51,left:37,right:39,fire:32}},N={},O={},M={qa:100,Ta:(N[8]=3,N[v.oc]=5,N[v.nc]=6,N[v.zc]=7,N[v.sc]=8,N[v.wc]=9,N[v.Q]=10,N[39]=16,N[221]=20,N[219]=21,N[v.ac]=22,N[v.tc]=23,N[v.pc]=24,N[v.E]=25,N[49]=26,N[37]=32,N[40]=34,N[117]=35,N[19]=35,N[192]=36,N[189]=37,N[57]=38,N[55]=39,N[52]=40,N[51]=41,N[27]=42,N[38]=48,N[114]=49,N[112]=50,N[46]=51,N[187]=52,N[48]=53,N[56]=54,N[54]=55,N[53]=56,N[50]=57,N[9]=58,N[103]=64,N[115]=65,N[113]=66,
N[96]=67,N[118]=68,N[220]=69,N[v.Fb]=70,N[v.dc]=71,N[v.Zb]=72,N[v.Yb]=73,N[v.ab]=74,N[104]=80,N[2013]=81,N[98]=82,N[97]=83,N[222]=85,N[186]=86,N[v.bc]=87,N[v.$b]=88,N[v.Cb]=89,N[v.rc]=90,N[110]=96,N[116]=97,N[101]=98,N[100]=99,N[13]=100,N[190]=101,N[188]=102,N[v.jc]=103,N[v.Vb]=104,N[v.yc]=105,N[119]=106,N[105]=112,N[99]=113,N[102]=114,N[109]=115,N[191]=117,N[v.ic]=118,N[v[" "]]=119,N[v.vc]=120,N[v.Wb]=121,N[v.vb]=122,N[120]=123,N[17]=124,N[16]=125,N[20]=126,N),rb:(O[v.p]=5,O[v.Rd]=6,O[v.y]=7,O[v.t]=
8,O[v.w]=9,O[v.q]=10,O[v["]"]]=20,O[v["["]]=21,O[v.Ed]=22,O[v.oe]=23,O[v.r]=24,O[v.e]=25,O[v["1"]]=26,O[v["`"]]=36,O[v["-"]]=37,O[v["9"]]=38,O[v["7"]]=39,O[v["4"]]=40,O[v["3"]]=41,O[v["="]]=52,O[v["0"]]=53,O[v["8"]]=54,O[v["6"]]=55,O[v["5"]]=56,O[v["2"]]=57,O[v["\\"]]=69,O[v.Od]=70,O[v.k]=71,O[v.Ad]=72,O[v.f]=73,O[v.a]=74,O[v["'"]]=85,O[v[";"]]=86,O[v.Nd]=87,O[v.Cd]=88,O[v.d]=89,O[v.me]=90,O[13]=100,O[v["."]]=101,O[v[","]]=102,O[v.n]=103,O[v.b]=104,O[v.x]=105,O[v["/"]]=117,O[v.Qd]=118,O[v.pe]=120,
O[v.c]=121,O[v.z]=122,O[v.oc]=133,O[v.nc]=134,O[v.zc]=135,O[v.sc]=136,O[v.wc]=137,O[v.Q]=138,O[v["}"]]=148,O[v["{"]]=149,O[v.ac]=150,O[v.tc]=151,O[v.pc]=152,O[v.E]=153,O[v["!"]]=154,O[v["~"]]=164,O[v._]=165,O[v["("]]=166,O[v["&"]]=167,O[v.$]=168,O[v["#"]]=169,O[v["+"]]=180,O[v[")"]]=181,O[v["*"]]=182,O[v["^"]]=183,O[v["%"]]=184,O[v["@"]]=185,O[v["|"]]=197,O[v.Fb]=198,O[v.dc]=199,O[v.Zb]=200,O[v.Yb]=201,O[v.ab]=202,O[v['"']]=213,O[v[":"]]=214,O[v.bc]=215,O[v.$b]=216,O[v.Cb]=217,O[v.rc]=218,O[v[">"]]=
229,O[v["<"]]=230,O[v.jc]=231,O[v.Vb]=232,O[v.yc]=233,O[v["?"]]=245,O[v.ic]=246,O[v.vc]=248,O[v.Wb]=249,O[v.vb]=250,O),Ub:{},cb:{},Va:{"caps-lock":20,ctrl:17,esc:27,tab:9,"num-comma":116,"break":117,"line-feed":118,"no-scroll":119,setup:120},Pc:{ra:130,INIT:127},Ca:{ra:130,dd:1,cd:2,bd:4,ad:8,ed:16,hc:32,fc:63,qd:64,ye:128,INIT:0},$c:127};M.cb={l4:M.Ca.dd,l3:M.Ca.cd,l2:M.Ca.bd,l1:M.Ca.ad,locked:M.Ca.ed,local:M.Ca.hc,online:~M.Ca.hc,"caps-lock":jf};var df={SI1978:pf,VT100:M};
M.INIT=[[M.Ca.INIT,M.Pc.INIT,!1,0,-1]];M.Ab={130:cf.prototype.Md};M.Bb={130:cf.prototype.de};vb(function(){for(var a=Kb("pcx80","keyboard"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new cf(d);Jb(d,c)}});
function Cf(a,b,c,d,e){z.call(this,"Video",a,512);var f=this;this.Ua=mb("Gecko/");this.N=a.screenWidth;this.I=a.screenHeight;this.ma=a.bufferAddr;this.yd=a.bufferRAM;var g=a.bufferFormat;this.Z=g&&Df[g.toUpperCase()]||Ef;this.P=a.bufferCols;this.aa=a.bufferRows;this.Ea=this.ha=a.cellWidth||1;this.da=a.cellHeight||1;this.ca=null;this.Na=!1;this.oa=a.bufferBits||1;this.zd=a.bufferLeft||0;if(this.i=a.bufferRotate)this.i=this.i%360,0<this.i&&(this.i-=360),-90!=this.i&&(this.ba("unsupported buffer rotation: "+
this.i),this.i=0);this.pa=a.interruptRate;this.wb=a.refreshRate||60;this.H=b;this.j=c;this.W=(this.Dd=d)||b||null;this.vd=this.N;this.wd=this.I;this.La=this.N/this.P|0;this.Ma=this.I/this.aa|0;1<this.da&&(this.aa++,this.ta=0,this.xa=!1);b=a.smoothing;(c=pb("smoothing"))&&(b="true"==c);this.Wa=b;this.Tb=nb(this.j,"imageSmoothingEnabled");if(this.B=a.screenRotate)this.B=this.B%360,0<this.B&&(this.B-=360),-90!=this.B?(this.ba("unsupported screen rotation: "+this.B),this.B=0):(this.j.translate(0,this.I),
this.j.rotate(this.B*Math.PI/180),this.j.scale(this.I/this.N,this.N/this.I));if(this.g=e)if(b=nb(e,"requestFullscreen")||nb(e,"requestFullScreen")){this.g.lb=e[b];if(e=nb(document,"on","fullscreenchange")){var h=nb(document,"fullscreenElement")||nb(document,"fullScreenElement");document.addEventListener(e,function(){Ff(f,null!=document[h])},!1)}(e=nb(document,"on","fullscreenerror"))&&document.addEventListener(e,function(){Ff(f)},!1)}if(this.T=a.fontROM)"json"!=Ka(this.T)&&(this.T=bb()+"/api/v1/dump?file="+
this.T+"&format=bytes"),$a(this.T,null,!0,function(k,m,p){Gf(f,k,m,p)});this.Aa={}}ta(Cf,z);
function Re(a){a.F=a.P*a.ha;a.O=a.aa*a.da;var b=a.F,c=a.O;a.i&&(b=a.O,c=a.F);a.K=0;if(!a.yd&&(a.K=(a.F*a.oa>>3)*a.O,!nc(a.J,a.ma,a.K,3)))return!1;a.K?(a.eb=a.j.createImageData(b,c),a.gb=16/a.oa|0,Hf(a,a.K>>1)):Hf(a,(a.P+1)*a.aa);a.G=document.createElement("canvas");a.G.width=b;a.G.height=c;a.ua=a.G.getContext("2d");a.U={};a.Y=1<<a.oa;a.V=Array(a.Y+If);a.V[0]=[0,0,0,255];a.V[1]=[255,255,255,255];a.Z==Jf&&(a.V[a.Y+Kf]=[255,255,0,255],a.V[a.Y+Lf]=[0,255,0,255]);a.Z==Mf&&(a.ib=60,a.za=!1,a.fa=Array(a.P));
a.Tb&&(a.j[a.Tb]=null==a.Wa?!1:a.Wa);return!0}l=Cf.prototype;l.ea=function(a,b,c){var d=this;if("led"==a||"rled"==a)return this.Aa[b]=c,!0;switch(b){case "fullScreen":return this.R[b]=c,this.g&&this.g.lb?c.onclick=function(){d.lb()}:c.parentNode.removeChild(c),!0}return!1};
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.L=d;Re(this);if(this.D=ic(a,"Keyboard")){for(var e in this.Aa)this.D.ea("led",e,this.Aa[e]);this.H&&this.D.ea(this.Dd?"textarea":"canvas","screen",this.W)}var f=this;this.Bc=yd(this.A,this.id,function(){Dd(f)});zd(this.A,this.Bc,1E3/Math.max(this.wb,this.pa));this.hb=0;this.T||Vb(this)};
function Gf(a,b,c,d){if(d)a.ba("Unable to load font ROM (error "+d+": "+b+")");else{Gb(a.Sa,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){x("Empty font ROM: "+b);return}if(1==f.length){x(f[0]);return}if(2048==f.length)a.ca=f,Se(a);else{a.ba("Unrecognized font data length ("+f.length+")");return}}catch(g){a.ba("Font ROM data error: "+g.message);return}(a.j||a.L)&&Vb(a)}}
function Se(a){a.ca&&(a.Na=a.Z==Mf,a.U[Nf]=[Of(a,a.ha,a.da),Of(a,a.ha,a.da,a.za)],a.U[Pf]=[Of(a,2*a.ha,a.da),Of(a,2*a.ha,a.da,a.za)],a.U[Qf]=a.U[Rf]=[Of(a,2*a.ha,2*a.da),Of(a,2*a.ha,2*a.da,a.za)])}
function Of(a,b,c,d){var e=8>=a.Ea?8:16,f=8<e?15:0,g=a.ca.length/e,h=!1===d,k={ha:b,da:c};k.canvas=document.createElement("canvas");k.canvas.width=16*b;k.canvas.height=g/16*c;k.context=k.canvas.getContext("2d");for(var m=k.context.createImageData(b,c),p=0;p<g;p++){for(var u=0,r=u;u<a.da;u++){var q=p*e+(f+u&e-1);q=d&&8==u?255:a.ca[q];for(var y=0;y<c/a.da;y++){for(var D=0,E=0,aa=E;E<a.ha;E++){var F=q&128>>(7<E?7:E);D=a.Na&&!F&&D?D:F;for(var sa=0;sa<b/a.ha;sa++)h&&(D=!D),Sf(a,m,aa,r,D?1:0),aa++;D=F}r++}}k.context.putImageData(m,
(p&15)*b,(p>>4)*c)}return k}l.wa=function(a,b){return b||!a||this.restore(a)?!0:!1};l.va=function(a){return!a||this.save()};l.save=function(){var a=new Ld(this);a.set(0,[]);return a.data()};l.restore=function(){return!0};
l.lb=function(){var a=!1;if(this.g){if(this.g.lb){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.N/this.I;b>c&&(a=Math.round(c/b*100)+"%")}this.Ua?(this.H.style.width=a,this.H.style.width=a,this.H.style.display="block",this.H.style.margin="auto"):(this.g.style.width=a,this.g.style.height="auto");this.g.style.backgroundColor="black";this.g.lb();a=!0}this.W&&this.W.focus()}return a};
function Ff(a,b){!b&&a.g&&(a.Ua?a.H.style.width=a.H.style.height="":a.g.style.width=a.g.style.height="");ec(a,"notifyFullScreen("+b+")")}function Hf(a,b){a.fb=b;a.X=!1;if(void 0===a.C||a.C.length!=a.fb)a.C=Array(a.fb)}function Sf(a,b,c,d,e){d=a.i?(b.height-c-1)*b.width+d:c+d*b.width;e&&a.Z==Jf&&(208<=c&&236>c?e=a.Y+Kf:28<=c&&72>c&&(e=a.Y+Lf));a=a.V[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
function Dd(a,b){var c=!0;if(!b){a.pa&&(120==a.pa?a.hb&1?(ie(a.A,2),c=!1):ie(a.A,1):ie(a.A,4));if(c&&a.X&&a.K){var d=a.J,e=a.ma,f=a.K,g=!0,h=e>>>d.i;for(e=d.B-(e&d.j);0<f&&h<d.g.length;)d.g[h].Ia&&(d.g[h].Ia=g=!1,d.g[h].Fc=!0),f-=e,e=d.B,h++;g&&(c=!1)}zd(a.A,a.Bc,1E3/Math.max(a.wb,a.pa));a.hb++}if(c)if(1<a.ha)switch(a.Z){case Mf:c=a.ma;d=-1;f=0;g=60==a.ib?2:5;e=h=0;for(var k=-1;f<a.aa;){var m=0,p=c,u=d,r=a.P;for(u!=Nf&&(r>>=1);;){var q=sc(a.J,p++);if((q&Tf)==Tf){var y=sc(a.J,p++);d=y&Uf;c=(y&Vf)<<
8|sc(a.J,p);c+=y&Wf?Xf:Yf;break}if(m<r)a.fa[m++]=q;else break}if(g)g--;else{for(;m<a.fa.length;)a.fa[m++]=0;if(0<=u)for(p=a.X&&a.C[h]==r,a.C[h++]=r,r=0;r<m;r++){q=a.fa[r];if(!p||q!==a.C[h]){a.C[k=h]=q;y=a;var D=a.ua;var E=q&127;if(q=y.U[u][q&128?1:0]){var aa=(E&15)*q.ha,F=(E>>4)*q.da,sa=q.ha,X=q.da;if(D){var ba=r*y.ha;var ka=f*y.da;var Fa=y.ha;E=y.da}else ba=r*y.La,ka=f*y.Ma,Fa=y.La,E=y.Ma;q.ha>y.ha&&(ba*=2,Fa*=2);q.da>y.da&&(u==Rf&&(F+=y.da),X=y.da);D?D.drawImage(q.canvas,aa,F,sa,X,ba,ka,Fa,E):y.j.drawImage(q.canvas,
aa,F,sa,X,ba,ka,Fa,E)}e++}h++}f++}}a.X=!0;!b&&a.xa&&1==e&&(a.C[k]=-1,e=0);a.xa=!1;(e||b)&&a.ua&&a.j.drawImage(a.G,0,a.ta,a.F,a.O-a.da,0,0,a.vd,a.wd)}else{f=a.ma;g=f+a.K;k=e=h=0;b=a.F;m=0;c=a.O;u=d=0;p=a.oa;r=(1<<p)-1;a.zd&&(p=-p,u=16+p);for(;f<g;){y=uc(a.J,f);if(a.X&&y===a.C[h])e+=a.gb;else{a.C[h]=y;(D=u)&&(y=y>>8|(y&255)<<8);e<b&&(b=e);for(q=a.gb;q--;)aa=y>>D&r,Sf(a,a.eb,e++,k,aa),D+=p;e>m&&(m=e);k<c&&(c=k);k>=d&&(d=k+1)}f+=2;h++;if(e>=a.F&&(e=0,k++,k>a.O))break}a.X=!0;b<a.F&&(f=m-b,d-=c,a.i&&(g=
b,h=f,b=c,f=d,c=a.F-(g+h),d=h),a.ua.putImageData(a.eb,0,0,b,c,f,d),a.j.drawImage(a.G,0,0,a.G.width,a.G.height,0,0,a.N,a.I))}}var Kf=0,Lf=1,If=2,Ef=0,Jf=1,Mf=2,Df={SI1978:Jf,VT100:Mf},Nf=96,Pf=64,Qf=32,Rf=0,Tf=127,Vf=15,Wf=16,Uf=96,Xf=8192,Yf=16384;
vb(function(){for(var a=Kb("pcx80","video"),b=0;b<a.length;b++){var c=a[b],d=Lb(c),e=Kb("pcjs-canvas","",c);if(e&&e.length&&e[0].getContext){var f=e[0];f.style.backgroundColor=d.screenColor;var g=f.getContext("2d")}else c.innerHTML="<br>Missing &lt;canvas&gt; support. Please try a newer web browser.";0<=db().indexOf("MSIE")&&(c.onresize=function(k,m,p,u){return function(){m.style.height=(k.clientWidth*u/p|0)+"px"}}(c,f,d.screenWidth,d.screenHeight),c.onresize());(e=+(d.aspect||pb("aspect")))&&.3<=
e&&3.33>=e&&(ub("onresize",function(k,m,p){return function(){m.style.height=(k.clientWidth/p|0)+"px"}}(c,f,e)),window.onresize());if(xa){var h=document.createElement("textarea");mb("iOS")&&(h.setAttribute("autocapitalize","off"),h.setAttribute("autocorrect","off"),h.style.fontSize="16px");c.appendChild(h)}d=new Cf(d,f,g,h,c);Jb(d,c)}});
function Zf(a){z.call(this,"SerialPort",a,4096);this.U=+a.adapter;switch(this.U){case 0:this.V=0;this.Y=2;break;default:x("Unrecognized serial adapter #"+this.U);return}this.i=this.j=null;this.W=a.tabSize;this.T=a.charBOL;this.B=0;this.O=!1;this.G=!0;a=a.binding;if("console"==a)this.j="";else if(a){var b=Ob("Panel",this.id);b&&(b=b.R[a])&&this.ea("",a,b)}this.C="";this.g=this.Ra=this.I=null;this.exports={connect:this.Hc,receiveData:this.Nb,receiveStatus:this.le}}ta(Zf,z);l=Zf.prototype;
l.ea=function(a,b,c,d){var e=this;return a&&"textarea"!=a?d?(this.R[b]=c,c.onclick=function(){e.Nb(d);return!0},!0):!1:(this.R[b]=this.i=c,c.onkeydown=function(f){f=f||n.event;var g=f.keyCode;if(8===g||f.ctrlKey&&65<=g&&90>=g)f.preventDefault&&f.preventDefault(),64<g&&(g-=64),$f(e,g);return!0},c.onkeypress=function(f){f=f||n.event;$f(e,f.which||f.keyCode);f.preventDefault&&f.preventDefault();return!0},c.removeAttribute("readonly"),!0)};
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.A=c;this.L=d;var e=this;this.Z=yd(this.A,this.id+".receive",function(){e.Nb()});this.aa=yd(this.A,this.id+".transmit",function(){lf(e)});this.X=ic(a,"ChipSet");Gc(b,this,ag,this.V);Jc(b,this,bg,this.V);Vb(this)};
l.Hc=function(a){if(!this.g){var b=bd(this.S,"connection");if(b){var c=b.split("->");if(2==c.length){var d=Wa(c[0]);if(d!=this.Gb)return;c=Wa(c[1]);if(this.g=Nb(c)){var e=this.g.exports;if(e){var f=e.connect;f&&f.call(this.g,this.G);if(this.Ra=e.receiveData){this.G=a;this.I=e.receiveStatus;this.status("Connected %s.%s to %s",this.Sa,d,c);return}}}}this.status("Unable to establish connection: %s",b)}}};
l.wa=function(a,b){if(!b)if(this.Hc(this.G),!a||!this.restore)this.reset();else if(!this.restore(a))return!1;return!0};l.va=function(a){return a?this.save():!0};l.reset=function(){cg(this)};l.save=function(){var a=new Ld(this),b=0,c=[];c[b++]=this.H;c[b++]=this.N;c[b++]=this.P;c[b++]=this.ja;c[b++]=this.D;c[b++]=this.F;c[b]=this.K;a.set(0,c);return a.data()};l.restore=function(a){return cg(this,a[0])};
function cg(a,b){var c=0;void 0===b&&(b=dg);a.H=b[c++];a.N=b[c++];a.P=b[c++];a.ja=b[c++];a.D=b[c++];a.F=b[c++];a.K=b[c];return!0}function eg(a,b){var c=a.K&b;b&15||(c>>=4);b=fg[c];c=((a.D&gg)>>2)+6;a.D&hg&&c++;c+=((a.D&ig)>>6)+1>>1;return 1E3/(b/c)|0}function $f(a,b){ec(a,"receiveByte("+w(b,2,!0)+"), status="+w(a.ja,2,!0));return a.O||a.ja&jg?!1:(a.N=b,a.ja|=jg,ie(a.A,a.Y),!0)}
l.Nb=function(a){null!=a&&(this.C="number"!=typeof a?a:this.C+String.fromCharCode(a));this.C&&($f(this,this.C.charCodeAt(0))&&(this.C=this.C.substr(1)),this.C&&this.A&&zd(this.A,this.Z,eg(this,kg)));return!0};l.le=function(a){this.ja&=~lg;a&64&&(this.ja|=lg)};function lf(a,b){a.ja=a.ja|Qe|mg;b&&a.Ra&&a.Ra.call(a.g,b)}l.Gd=function(a,b){var c=this.N;A(this,a,void 0,b,"DATA",c);this.ja&=~jg;return c};l.Fd=function(a,b){var c=this.ja;A(this,a,void 0,b,"STATUS",c);return c};
l.Ud=function(a,b,c){A(this,a,b,c,"DATA");this.P=b;this.ja&=~(Qe|mg);ec(this,"transmitByte("+w(b,2,!0)+")");if(19==b)this.O=!0;else if(17==b)this.O=!1;else if(this.Ra&&this.Ra.call(this.g,b),this.i)if(8==b)this.i.value=this.i.value.slice(0,-1),0<this.B&&this.B--;else{var d;13!=b&&10!=b&&(d=Xa[b]);a=d=d?"<"+d+">":String.fromCharCode(b);c=a.length;9==b?(b=this.W||8,c=b-this.B%b,this.W&&(a=Oa("",c))):13==b&&(this.B=c=0,a="\n");this.T&&!this.B&&c&&(a=String.fromCharCode(this.T)+a);this.i.value+=a;this.i.scrollTop=
this.i.scrollHeight;this.B+=c}else if(null!=this.j){if(10==b||1024<=this.j.length)this.ia(this.j),this.j="";10!=b&&(this.j+=String.fromCharCode(b))}this.A&&zd(this.A,this.aa,eg(this,ng))};l.Td=function(a,b,c){A(this,a,b,c,"CONTROL");this.H?(this.I&&(b^this.F)&(og|pg)&&(a=0,this.G?(a|=b&og?32:0,a|=b&pg?320:0):(a|=b&og?16:0,a|=b&pg?1048576:0),this.I.call(this.g,a)),this.F=b,this.F&qg&&(this.H=!1)):(this.D=b,this.H=!0)};l.Sd=function(a,b,c){A(this,a,b,c,"BAUDRATES");this.K=b};
var gg=12,hg=16,ig=192,pg=2,og=32,qg=64,Qe=1,jg=2,mg=4,lg=128,kg=15,ng=240,fg=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],dg=[!1,0,0,133,142,39,238],ag={0:Zf.prototype.Gd,1:Zf.prototype.Fd},bg={0:Zf.prototype.Ud,1:Zf.prototype.Td,2:Zf.prototype.Sd};vb(function(){for(var a=Kb("pcx80","serial"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new Zf(d);Jb(d,c)}});
function rg(a,b,c){z.call(this,a,b,c);this.B=+b.base||16;this.X=["{","}"];this.fa=["[","]"];this.U=this.ca=this.H=0;this.P=!1;this.g=-1;this.i=[];this.C={}}ta(rg,z);rg.prototype.Jb=function(){return-1};rg.prototype.Kb=function(){};
rg.prototype.zb=function(a,b,c){if(b)if(a){0>this.g&&this.i.length&&(this.g=0);if(0>this.g||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if('"'==g||"'"==g)e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Wa(a.substring(d,f))),d=f+1}}return b};
function sg(a,b,c){var d=a;b=b||32;if(c)if(32==b)d=a>>>0;else if(32>b)d=a&(1<<b)-1;else{if(b=Math.pow(2,b),0>a||a>=b)d=a%b,0>d&&(d+=b)}else 32>=b?d=a<<32-b>>32-b:(b=Math.pow(2,b-1),a>=b?(d=a%b,(a/b|0)&1&&(d-=b)):a<-b&&(d=a%b,((-a-1)/b|0)&1?d&&(d+=b):d||(d-=b)));a!=d&&(a=d);return a}
function tg(a,b,c){for(c=void 0===c?-1:c;c--&&b.length;){var d=b.pop();if(2>a.length)return!1;var e=a.pop();var f=a.pop();switch(d){case "*":f*=e;break;case "/":if(!e)return!1;f=Math.trunc(f/e);break;case "^/":if(!e)return!1;f%=e;break;case "+":f+=e;break;case "-":f-=e;break;case "<<":f<<=e;break;case ">>":f>>=e;break;case ">>>":f>>>=e;break;case "<":f=f<e?1:0;break;case "<=":f=f<=e?1:0;break;case ">":f=f>e?1:0;break;case ">=":f=f>=e?1:0;break;case "==":f=f==e?1:0;break;case "!=":f=f!=e?1:0;break;
case "&":f&=e;break;case "!":case "|":f|=e;break;case "^!":f^=e;break;case "&&":f=f&&e?1:0;break;case "||":f=f||e?1:0;break;case ",,":f=sg(f,18,!0)*Math.pow(2,18)+sg(e,18,!0);break;case "_":case "^_":"^_"==d&&(e=35-(e&255));e&&(f=sg(f,0,!0),f=0<e?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));break;default:return!1}a.push(sg(f))}return!0}
function ug(a,b,c,d,e,f){var g,h=!1,k=0,m=[],p=[],u=a.B;for(a.B=e;c<d;){var r=b[c++].trim();var q=c<d?b[c++]:"";if(r)var y=vg(a,r,void 0,f,k);else if("{"==q){r=1;for(y=c;c<d;)if(c++,q=c<b.length?b[c++]:"","{"==q)r++;else if("}"==q&&!--r)break;y=ug(a,b,y,c-1,a.B,f);null!=y&&k&&(y=wg(y,k));r=c<d?b[c++].trim():"";q=c<d?b[c++]:""}else{if(" "==q)continue;if("^B"==q){a.B=2;continue}if("^O"==q){a.B=8;continue}if("^D"==q){a.B=10;continue}if(!(k&-1073741824)){if("+"==q)continue;if("-"==q){k=k<<2|1;continue}if("~"==
q||"^-"==q){k=k<<2|2;continue}if("^L"==q){k=k<<2|3;continue}}h=!0;break}if(void 0===y)if(f)f.push(r),y=0;else{h=!0;f=[];break}m.push(sg(y));if(" "==q)if(c<b.length-1&&!b[c])c++,q=b[c++];else{h=!0;break}if(!q)break;k="<"==a.X[0]?xg:yg;if(!k[q]){h=!0;break}p.length&&k[q]<=k[p[p.length-1]]&&tg(m,p,1);p.push(q);a.B="^_"==q?10:e;k=0}if(h||!tg(m,p)||1!=m.length)h=!0;h?f||a.ia("parse error ("+(r||q)+")"):g=m.pop();a.B=u;return g}
function zg(a,b,c,d,e){for(var f;0<=(f=b.indexOf(c));){for(var g=0,h=f+1,k=e;h<b.length;){var m=b[h++];if(m==c){k=-1;break}if(!k)break;k--;m=m.charCodeAt(0);7==d?m&=127:m=m-32&63;g=sg(g*Math.pow(2,d)+m,d*e,!0)}if(0<=k){a.ia("parse error ("+c+b+c+")");return}b=b.substr(0,f)+Ag(a,g,-1)+b.substr(h)}return b}
function Bg(a,b,c){var d=void 0,e=!1===c;c=Array.isArray(c)?c:void 0;if(b){"{"!=a.X[0]&&(b=b.split(a.X[0]).join("{").split(a.X[1]).join("}"));b=zg(a,b,'"',7,5);if(!b)return d;b=zg(a,b,"'",6,6);if(!b)return d;16!=a.B&&(b=b.replace(/(^|[^A-Z0-9$%.])([0-9]+)B/,"$1$2^_").replace(/\s+/g," "));b=b.split(/({|}|\|\||&&|\||\^!|\^B|\^O|\^D|\^L|\^-|~|\^_|_|&|!=|!|==|>=|>>>|>>|>|<=|<<|<|-|\+|\^\/|\/|\*|,,| )/);d=ug(a,b,0,b.length,a.B,c);void 0!==d&&e&&Cg(a,null,d)}return d}
function Dg(a,b){var c=a.X[0],d=a.X[1];var e="("==c||"{"==c||"["==c?"\\":"";var f="["==c?"\\":"";for(f=new RegExp(e+c+"([^"+f+c+f+d+"]+)"+e+d);e=b.match(f);){var g=Bg(a,e[1]);if(void 0===g)return;b=b.replace(c+e[1]+d,null!=g?Ag(a,g):"undefined")}if(a.fa.length)for(c=a.fa[0],d=a.fa[1],e="("==c||"{"==c||"["==c?"\\":"",f="["==c?"\\":"",f=new RegExp(e+c+"([^"+f+c+f+d+"]+)"+e+d);e=b.match(f);)b=b.replace("["+e[1]+"]","unimplemented");for(;c=b.match(/\$([a-z]+)/i);){d=null;switch(c[1].toLowerCase()){case "ops":d=
a.U-a.ca}if(null==d)break;b=b.replace(c[0],d.toString())}return b}function wg(a,b){for(;b;){var c;switch(b&3){case 1:a=-sg(a);break;case 2:a^=-1;break;case 3:for(c=35;0<=c&&!(a&Math.pow(2,c));)c--;a=35-c}b>>>=2}return a}
function vg(a,b,c,d,e){e=void 0===e?0:e;var f=Array.isArray(d)?d:void 0;if(void 0!=b){var g=a.Jb(b);if(0<=g)g=a.Kb(g);else if(g=b,a.C[g]?g=a.C[g].value:(g=g.substr(0,6),g=a.C[g]&&a.C[g].value),void 0!=g){var h=a.C[b]&&a.C[b].ne;h&&(f?f.push(h):(f=Bg(a,h,d),void 0!==f?g+=f:(d||a.ia("undefined "+(c||"value")+": "+b+" ("+h+")"),g=void 0)))}else g=Ea(b,1<b.length||10<a.B?a.B:10);void 0!=g?g=sg(wg(g,e)):d||a.ia("invalid "+(c||"value")+": "+b)}else d||a.ia("missing "+(c||"value"));return g}
function Cg(a,b,c){var d=!1;if(void 0!==c){d=!0;var e=8==a.B?Ag(a,c,32,8,1)+"  "+c+".":Ag(a,c,32,16,1)+"  "+Ag(a,c,32,8,1)+"  "+Ag(a,c,32,2,8)+"  "+c+".";32<=c&&127>c&&(e+=" '"+String.fromCharCode(c)+"'")}a.ia((null!=b?b+": ":"")+e);return d}function Eg(a,b){var c=0;if(a.C){if(b)return Cg(a,b,a.C[b]&&a.C[b].value);b=Object.keys(a.C);b.sort();for(var d=0;d<b.length;d++)Cg(a,b[d],a.C[b[d]].value),c++}return 0<c}
function Ag(a,b,c,d,e){c=void 0===c?0:c;e=void 0===e?0:e;switch((void 0===d?0:d)||a.B){case 2:(a=0<c?c:0)?36<a&&(a=36):(a=Math.abs(b),a=255>=a?8:262143>=a?18:36);b=Ga(b,2,a,"",e);break;case 8:(a=0<c?(c+2)/3|0:0)?12<a&&(a=12):(a=Math.abs(b),a=262143>=a?6:16777215>=a?8:12);b=Ga(b,8,a,e?"0o":"");break;case 10:(e=0<c?Math.ceil(.3*c):0)?11<e&&(e=11):e=99999>=Math.abs(b)?5:11;b=Ga(b,10,e);break;default:b=w(b,0<c?c+3>>2:0,!!e)}return c=0>c?b.replace(/^0+([0-9A-F]+)$/i,"$1"):b}
var yg={"||":5,"&&":6,"!":7,"|":7,"^!":8,"&":9,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,_:19,"^_":19,"{":20,"}":20},xg={",,":1,"||":5,"&&":6,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"!":15,"|":15,"^!":15,"&":15,_:19,"^_":19,"{":20,"}":20};
function Fg(a){rg.call(this,"Debugger",a,-1);this.style=Gg;this.N=Hg();this.ta=Hg();this.V=Hg();this.F=[];this.j=this.O=this.D=[];jh(this);this.Y=0;lh(this);this.ma={};mh(this,a.messages);this.oa=a.commands;var b=this;void 0===n.pcx80&&(n.pcx80=function(c){return fd(b,c)})}ta(Fg,rg);l=Fg.prototype;
l.Fa=function(a,b,c,d){this.J=b;this.A=c;this.S=a;(a=bd(a,"messages"))&&mh(this,a);this.pa=nh;re(this,4,function(e){a:{var f=d.J.g,g=e[0],h=e=0,k=f.length;if(g){e=oh(ph(d,g));if(-1===e){d.u("invalid address: %s\n",g);break a}h=e>>>d.J.i;k=1}d.u("blockid   physical   blockaddr   used    size    type\n");d.u("--------  ---------  ----------  ------  ------  ----\n");g=-1;for(var m=0;k--;){var p=f[h];p.type==g?m++||d.u("...\n"):(g=p.type,m=qc[g],p&&d.u("%x  %%x  %%%x  %#06x  %#06x  %s\n",p.id,h<<d.J.i,
p.M,p.ob,p.size,m),g!=Pc&&(g=-1),m=0);e+=d.J.B;h++}}});Vb(this)};
l.ea=function(a,b,c){var d=this;switch(b){case "debugInput":return this.K=this.R[b]=c,c.onkeydown=function(e){if(13==e.keyCode){var f=d.K.value;d.K.value="";fd(d,f,!0)}else if(27==e.keyCode)d.K.value=f="";else if(38==e.keyCode?(f=null,d.g<d.i.length-1&&(f=d.i[++d.g])):40==e.keyCode&&(0<d.g?f=d.i[--d.g]:(f="",d.g=-1)),null!=f){var g=f.length;d.K.value=f;d.K.setSelectionRange(g,g)}null!=f&&e.preventDefault&&e.preventDefault()},!0;case "debugEnter":return this.R[b]=c,tb(c,function(){if(d.K){var e=d.K.value;
d.K.value="";fd(d,e,!0);return!0}return!1}),!0;case "step":return this.R[b]=c,tb(c,function(e){var f=!1;Wb(d,!0)||(Xb(d,!0),f=qh(d,e?1:0),Xb(d,!1));return f}),!0}return!1};l.Za=function(){this.K&&this.K.focus()};function oh(a){a=a&&a.M;null==a&&(a=-1);return a}l.Ga=function(a,b){var c=255,d=oh(a);-1!==d&&(c=sc(this.J,d),b&&rh(a,b));return c};l.Eb=function(a,b){var c=65535,d=oh(a);-1!==d&&(c=uc(this.J,d),b&&rh(a,b));return c};
l.cc=function(a,b,c){var d=oh(a);-1!==d&&(Ec(this.J,d,b),c&&rh(a,c),gd(this.A,!0))};l.Zc=function(a,b,c){var d=oh(a);if(-1!==d){var e=this.J,f=d&e.j,g=(d&e.F)>>>e.i;f!=e.j?e.g[g].Sb(f,b&65535,d):(e.g[g++].pb(f,b&255,d),e.g[g&e.I].pb(0,b>>8&255,d+1));c&&rh(a,c);gd(this.A,!0)}};function Hg(a){return{M:a,Da:!1}}function sh(a){return{M:a[0],Da:a[1]}}
function ph(a,b,c){c=(c?a.N:a.ta).M;if(void 0!==b){b=Dg(a,b)||b;var d;if(b.match(/^[a-z_][a-z0-9_]*$/i)){var e=b.toUpperCase();for(c=0;c<a.F.length;c++){var f=a.F[c].sa[e];if(void 0!==f){e=f.o;void 0!==e&&(d=Hg(e));break}}}if(e=d)return e;c=Bg(a,b)}null!=c&&(e=Hg(c));return e}function th(a,b,c){c&&(c=c.match(/(['"])(.*?)\1/))&&(b.ud=a.zb(b.Lc=c[2]))}function rh(a,b){null!=a.M&&(a.M+=b||1)}function uh(a){return w(a.M,4)}
function vh(a,b,c){var d="";for(c=c||256;d.length<c;){var e=a.Ga(b,1);if(!e||36==e||127<=e)break;d+=32<=e?String.fromCharCode(e):"."}return d}function mh(a,b){a.L=a;a.ga=549755813888;a.Z=null;a.aa=[];b=a.zb(b.replace("keys","key").replace("kbd","keyboard"),!1,"|");if(b.length)for(var c in t)0<=Za(b,c)&&(a.ga|=t[c],a.u("%s messages enabled\n",c))}function re(a,b,c){for(var d in t)if(b==t[d]){a.ma[d]=c;break}}
l.Jb=function(a,b){a=a.toUpperCase();if(null==b)var c=Za(wh,a);else c=Za(wh,a.substr(b,2)),0>c&&(c=Za(wh,a.substr(b,1)));return c};function xh(a,b){var c=0;a=a.Kb(b);if(void 0!==a)switch(b){case yh:case zh:case Ah:case Bh:case Ch:case Dh:case Eh:case Fh:c=2;break;case Gh:case Hh:case Ih:case Jh:case Kh:case Lh:case Mh:c=4}return c?w(a,c):"??"}
l.Kb=function(a){if(0<=a){var b=this.A;switch(a){case yh:var c=b.i;break;case zh:c=b.B;break;case Ah:c=b.C;break;case Gh:c=Md(b);break;case Bh:c=b.D;break;case Ch:c=b.F;break;case Hh:c=Od(b);break;case Dh:c=b.G;break;case Eh:c=b.H;break;case Ih:c=C(b);break;case Fh:c=G(b,C(b));break;case Jh:c=b.N;break;case Kh:c=b.j;break;case Lh:c=Kd(b);break;case Mh:c=Kd(b)&255|b.i<<8}}return c};
l.message=function(a,b){b&1&&this.A&&(a=a.replace(/(\n?)$/," @"+uh(Hg(this.A.j))));this.ga&0x800000000000?this.aa.push(a):this.Z&&a==this.Z||(this.Z=a,this.ga&70368744177664&&(a=a.replace(/(\n?)$/," (cpu halted)$1"),Zc(this)),this.print(a,b),this.A&&(a=this.A,Ad(a),a.ua=0,gd(a)))};function fc(a,b,c,d,e,f,g,h){h|=16;null!=f&&(a.ga&h)!=h||a.u("%s.%s(%#06x,%s=%#04x): %#04x @%#06x\n",b.Gb,null!=d?"outPort":"inPort",c,f||"unknown",d,g,e)}
function lh(a){var b;if(je(a)){if(!a.I||!a.I.length){a.I=Array(Nh);for(b=0;b<a.I.length;b++)a.I[b]=Hg();a.W=0;a.u("instruction history buffer allocated\n")}if(!a.G||!a.G.length)for(a.G=Array(256),b=0;b<a.G.length;b++)a.G[b]=[b,0]}else a.I&&a.I.length&&a.u("instruction history buffer freed\n"),a.W=0,a.I=[],a.G=[]}function Oh(a,b){if(!Ph(a))return!1;a.A.tb(b);return!0}
function qh(a,b,c,d){if(!Ph(a))return!1;a.H=0;b||je(a)&&ke(a,a.A.j,0);try{var e=a.A.Db(b);0<e&&(a.H+=e,ld(a.A,e,!0),hd(a.A,e),a.U++)}catch(f){"number"!=typeof f&&(b=f,a.H=0,Tb(a.A,b.stack||b.message))}!1!==d&&gd(a.A);ed(a,c||!1);return 0<a.H}function Zc(a,b){a.A&&jd(a.A,b)}function ed(a,b){void 0===b&&(b=!0);a.N=Hg(a.A.j);b&&1!=a.T?Qh(a):Rh(a)}
function Ph(a){var b;if(b=a.A&&Ub(a.A))b=a.A,b.flags.ka?b=!0:(b.ia(b.toString()+" not powered"),b=!1);b&&!Wb(a.A)?(a=a.A,a.flags.error?(a.print(a.toString()+" error\n"),a=!0):a=!1,a=!a):a=!1;return a}l.wa=function(a,b){return!b&&(this.reset(!0),a&&this.restore&&!this.restore(a))?!1:!0};l.va=function(a,b){b&&this.u("%s\n",a?"suspending":"shutting down");return a?this.save():!0};l.reset=function(a){lh(this);this.U=this.ca=0;this.Z=null;this.H=0;this.N=Hg(this.A.j);this.flags.la=!1;Sh(this);a||ed(this)};
l.save=function(){var a=new Ld(this),b=this.N;a.set(0,[b.M,b.Da]);b=this.V;a.set(1,[b.M,b.Da]);a.set(2,[this.i,this.P,this.ga]);a.set(3,this.F);return a.data()};l.restore=function(a){var b=0;void 0!==a[2]&&(this.N=sh(a[b++]),this.V=sh(a[b++]),this.i=a[b][0],"string"==typeof this.i&&(this.i=[this.i]),this.P=a[b][1],this.ga|=a[b][2]);a[3]&&(this.F=a[3]);return!0};l.start=function(a,b){this.T||this.u("running\n");this.flags.la=!0;this.za=a;this.Aa=b};
l.stop=function(a,b){if(this.flags.la){this.flags.la=!1;this.H=b-this.Aa;if(!this.T){b="stopped";if(this.H){a-=this.za;var c=0<a?Math.round(1E3*this.H/a):0;b+=" (";je(this)&&(b+=this.U+" opcodes, ",this.ca-=this.U,this.U=0);b+=this.H+" cycles, "+a+" ms, "+c+" hz)"}else Zb(this,70368744177664)&&(b+=" (use the 't' command to execute blocked faults)");this.u("%s\n",b)}ed(this,!0);this.Za();Sh(this,this.A.j)}};function je(a){return 1<a.j.length||!!a.Y}
function ke(a,b,c){var d=a.A;if(0<c&&(a.Y&&!--a.Y||Yc(a,b,1,a.j)))return!0;0<=c&&a.G.length&&(a.U++,b=sc(a.J,b),null!=b&&(a.G[b][1]++,b=a.I[a.W],b.M=d.j,b.Da=!1,++a.W==a.I.length&&(a.W=0)));return!1}function Ic(a,b,c){a.u("break on input from port %#06x: %x\n",b,c);Zc(a,!0)}function Lc(a,b,c){a.u("break on output to port %#06x: %x\n",b,c);Zc(a,!0)}
function jh(a){var b;a.j=["bp"];if(void 0!==a.O)for(b=1;b<a.O.length;b++){var c=a.O[b];var d=a.J;Xc(d.g[oh(c)>>>d.i],!1)}a.O=["br"];if(void 0!==a.D)for(b=1;b<a.D.length;b++)c=a.D[b],d=a.J,Xc(d.g[oh(c)>>>d.i],!0);a.D=["bw"];a.ua=0}l.Pa=function(a,b,c){var d=!0;c||Th(this,a,b,!1,!0);if(a!=this.j){var e=oh(b);if(-1===e)this.u("invalid address: %s\n",uh(b)),d=!1;else{var f=this.J;f.g[e>>>f.i].Pa(e&f.j,a==this.D)}}d&&(a.push(b),c?b.Da=!0:(Uh(this,a,a.length-1,"set"),lh(this)))};
function Th(a,b,c,d,e){var f=!1;c=oh(c);for(var g=1;g<b.length;g++){var h=b[g];if(c==oh(h)&&(!d||h.Da)){f=!0;h.Da||e||Uh(a,b,g,"cleared");b.splice(g,1);b!=a.j&&(d=a.J,Xc(d.g[c>>>d.i],b==a.D));h.Da||lh(a);break}}return f}function Vh(a,b){for(var c=1;c<b.length;c++)Uh(a,b,c);return b.length-1}function Uh(a,b,c,d){c=b[c];a.u("%s %s%s\n",b[0],uh(c),d?" "+d:c.Lc?' "'+c.Lc+'"':"")}
function Sh(a,b){if(void 0!==b)Yc(a,b,1,a.j,!0),a.T=0;else for(b=1;b<a.j.length;b++){var c=a.j[b];if(c.Da){if(!Th(a,a.j,c,!0))break;b=0}}}
function Yc(a,b,c,d,e){var f=!1;if(!a.ua++)for(var g=1;!f&&g<d.length;g++){var h=d[g];if(!e||h.Da)for(var k=oh(h),m=0;m<c;m++)if(b+m==k){var p;f=!0;h.Da&&(Th(a,d,h,!0),e=!0);if(p=h.ud){f=!1;for(var u=0;u<p.length;u++)if(!Wh(a,p[u],!0)){if(p[u].indexOf("if")){f=!0;break}for(var r=u+1;r<p.length&&p[r].indexOf("else");r++)u++;if(r==p.length){f=!0;break}}a.A.flags.la||(f=!0)}if(f){e||Uh(a,d,g,"hit");break}}}a.ua--;return f}
function Xh(a,b,c,d){for(var e=Hg(b.M),f=a.Ga(b,1),g=a.pa[f],h="",k=(a.style!=Yh?Zh:$h)[g[0]],m=g.length-1,p=ai,u,r=1;r<=m;r++){var q="";u=g[r];if(void 0!==u&&!(u&P&&a.style==Gg)){var y=u&bi;if(y){var D=u&ci;D?p=D:u|=p;u&di||(u|=1==r?ei:fi);if(y&Q)a:{q=a;y=u;D=b;switch(y&ci){case gi:D=w(q.Ga(D,1),2);break;case hi:D=w(q.Ga(D,1)<<24>>24,4);break;case ii:D=w(q.Eb(D,2),4);break;default:q="imm("+Ia(y)+")";break a}q.style==Yh&&y&ji?D="["+D+"]":y&ki||(D=(q.style==Gg?"$":"0x")+D);q=D}else y&ki?(q=(u&li)>>
8,y=wh[q],a.style==Yh&&u&ji&&(q==Fh&&(y="HL"),y="["+y+"]"),q=y):y&mi&&(q=(f>>3&7).toString());if(!q||!q.length){h="INVALID";break}0<h.length&&(h+=",");h+=q||"???"}}}f="";g=uh(e)+" ";if(-1!==e.M&&-1!==b.M){do if(f+=w(a.Ga(e,1),2),null==e.M)break;while(e.M!=b.M)}g+=Oa(f,10);g+=u&ni?"*":" ";g+=Oa(k,7);h&&(g+=" "+h);c&&(g=Oa(g,40)+";"+c,g=a.A.flags.Xa?g+("cycles="+id(a.A).toString()+" cs="+w(a.A.xa)):g+(null!=d?"="+d.toString():""));return g}
function oi(a,b){switch(b){case "IF":a=a.A.O&512;break;case "SF":a=Wd(a.A);break;case "ZF":a=Vd(a.A);break;case "AF":a=Ud(a.A);break;case "PF":a=Td(a.A);break;case "CF":a=Rd(a.A);break;default:a=0}return b.charAt(0)+(a?"1":"0")+" "}function pi(a,b){return wh[b]+"="+xh(a,b)+" "}l.Cc=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
function qi(a,b,c){var d=[],e=oh(b)>>>0;for(b=0;b<a.F.length;b++){var f=a.F[b],g=f.M>>>0,h=f.Pd;if(e>=g&&e<g+h){e=Ya(f.Ac,[e-g],a.Cc);0<=e?ri(a,b,e,d):c&&(e=~e,ri(a,b,e-1,d),ri(a,b,e,d));break}}return d}function ri(a,b,c,d){var e={},f=a.F[b].Ac,g=0,h=null;0<=c&&c<f.length&&(g=f[c][0],h=f[c][1]);h&&(e=a.F[b].sa[h],h="."==h.charAt(0)?null:e.l||h);d.push(h);d.push(g);d.push(e.a);d.push(e.c)}
function si(a,b){if("?"==b)a.u("frequency commands:\n"),a.u("\tclear\tclear all frequency counts\n");else{var c=0;if(a.G)if("clear"==b){for(b=0;b<a.G.length;b++)a.G[b]=[b,0];a.u("frequency data cleared\n");c++}else if(void 0!==b)a.u("unknown frequency command: %s\n",b),c++;else{var d=a.G.slice();d.sort(function(h,k){return k[1]-h[1]});var e=a.style!=Yh?Zh:$h;for(b=0;b<d.length;b++){var f=d[b][0],g=d[b][1];g&&(a.u("%s (%#04x): %d times\n",(e[a.pa[f][0]]+"  ").substr(0,5),f,g),c++)}}c||a.u("no frequency data available\n")}}
function ti(a,b){var c=b.match(/^\s*([A-Z_]?[A-Z0-9_]*)\s*(=?)\s*(.*)$/i);if(c){if(!c[1])return Eg(a)||a.u("no variables\n"),!0;if(!c[2])return Eg(a,c[1]);if(!c[3])return delete a.C[c[1]],!0;b=Bg(a,c[3]);return void 0!==b?(a.C[c[1]]={value:b,ne:void 0},!0):!1}a.u("invalid assignment: %s\n",b);return!1}
function ui(a,b,c){var d=null;if(b=ph(a,b,!0)){var e=qi(a,b,!0);if(e.length){var f;if(e[0]){var g="";(f=b.M-e[1])&&(g=" + "+Ia(f));f=e[0]+" ("+w(e[1],4)+")"+g;c&&a.u("%s\n",f);d=f}4<e.length&&e[4]&&(g="",(f=e[5]-b.M)&&(g=" - "+Ia(f)),f=e[4]+" ("+w(e[5],4)+")"+g,c&&a.u("%s\n",f),d||(d=f))}else c&&a.u("no symbols\n")}return d}
function vi(a,b){switch(b[1]){case "8080":a.style=Gg;break;case "8086":a.style=Yh;break;case "cs":var c;void 0!==b[3]&&(c=+b[3]);switch(b[2]){case "int":a.A.oa=c;break;case "start":a.A.za=c;break;case "stop":a.A.ta=c;break;default:a.u("unknown cs option\n");return}void 0!==c&&dd(a.A);a.u("checksums %s\n",a.A.flags.Xa?"enabled":"disabled");return;case "sp":void 0!==b[2]&&(kd(a.A,+b[2])||a.u("warning: using 1x multiplier, previous target not reached\n"));a.u("target speed: %s (%dx)\n",a.A.aa.toFixed(2)+
"Mhz",a.A.U);return;case "?":a.u("debugger options:\n");a.u("\tX80\t\tselect 8080-style mnemonics\n");a.u("\t8086\t\tselect 8086-style mnemonics\n");a.u("\tcs int #\tset checksum cycle interval to #\n");a.u("\tcs start #\tset checksum cycle start count to #\n");a.u("\tcs stop #\tset checksum cycle stop count to #\n");a.u("\tsp #\t\tset speed multiplier to #\n");break;default:if(b[1]){a.u("unknown option: %s\n",b[1]);return}}a.u("%s-style mnemonics enabled\n",a.style)}
function Qh(a,b){var c;if(b&&"?"==b[1])a.u("register commands:\n"),a.u("\tr\tdump registers\n"),a.u("\trx [#]\tset flag or register x to [#]\n");else{var d=a.A;null==c&&(c=!0);if(null!=b&&1<b.length){var e=b[1],f=e.indexOf("=");if(0<f)b=e.substr(f+1),e=e.substr(0,f);else if(2<b.length)b=b[2];else{a.u("missing value for %s\n",b[1]);return}f=Bg(a,b);if(void 0===f)return;switch(e.toUpperCase()){case "A":d.i=f&255;break;case "B":d.B=f&255;break;case "BC":d.B=f>>8&255;case "C":d.C=f&255;break;case "D":d.D=
f&255;break;case "DE":d.D=f>>8&255;case "E":d.F=f&255;break;case "H":d.G=f&255;break;case "HL":d.G=f>>8&255;case "L":d.H=f&255;break;case "SP":d.N=f&65535;break;case "PC":B(d,f);a.N=Hg(d.j);break;case "PS":Id(d,f);break;case "PSW":Id(d,f&255|d.O&-256);d.i=f>>8;break;case "CF":d.I=f?d.I|256:d.I&255;break;case "PF":f?Td(d)||(d.K^=1):Td(d)&&(d.K^=1);break;case "AF":d.P=f?~d.K&16|d.P&-17:d.K&16|d.P&-17;break;case "ZF":d.I=f?d.I&-256:d.I|255;break;case "SF":f?Wd(d)||(d.K^=192):Wd(d)&&(d.K^=192);break;
case "IF":d.O=f?d.O|512:d.O&-513;break;default:a.u("unknown register: %s\n",e);return}gd(d);a.u("updated registers:\n")}e=a.u;f=pi(a,yh)+pi(a,Gh)+pi(a,Hh)+pi(a,Ih)+pi(a,Jh)+oi(a,"IF")+oi(a,"SF")+oi(a,"ZF")+oi(a,"AF")+oi(a,"PF")+oi(a,"CF");e.call(a,"%s\n",f);c&&(a.N=Hg(d.j),Rh(a,uh(a.N)))}}
function wi(a,b){b=Wa(b);var c=b.match(/^(['"])(.*?)\1$/);if(c){b=a.u;c=c[2];c=Dg(a,c)||c;for(var d=0,e,f;0<=(d=c.indexOf("@",d));)f=a.Jb(c,d+1),0<=f&&(c=c.substr(0,d)+xh(a,f)+c.substr(d+1+wh[f].length)),d++;for(d=0;0<=(d=c.indexOf("#",d));)f=c.substr(d+1,2),e=Ea(f,16),null!=e&&32<=e&&127>e?(e=f+" '"+String.fromCharCode(e)+"'",c=c.replace("#"+f,e),d+=e.length):d++;for(d=0;0<=(d=c.indexOf("$",d));)f=c.substr(d+1,9),(e=ph(a,f))?(e=f+' "'+vh(a,e)+'"',c=c.replace("$"+f,e),d+=e.length):d++;for(d=0;0<=
(d=c.indexOf("^",d));)f=c.substr(d+1,9),(e=ph(a,f))?(rh(e),e=f+' "'+vh(a,e,11)+'"',c=c.replace("^"+f,e),d+=e.length):d++;b.call(a,"%s\n",c)}else Bg(a,b,!1)}function xi(a,b,c){var d="t"!=b;c=vg(a,c,void 0,!0)||1;var e=1==c?0:1;"tc"==b&&(e=c,c=1);rb(c,function(){return Xb(a,!0)&&qh(a,e,d,!1)},function(){gd(a.A);Xb(a,!1)})}
function Rh(a,b,c,d){if(b=ph(a,b,!0)){void 0===d&&(d=1);var e=256;if(void 0!==c){d=ph(a,c,!0);if(!d||d.M<b.M)return;e=d.M-b.M;if(256<e){a.u("range too large\n");return}d=-1}c=0;for(var f;0<e&&d--;){f=Wb(a,!1)||a.T?a.H:null;var g=null!=f?"cycles":null,h=qi(a,b),k=b.M;if(h[0]&&d&&(!c&&d||0>h[0].indexOf("+"))){var m=h[0]+":";h[2]&&(m+=" "+h[2]);a.u("%s\n",m)}h[3]&&(g=h[3],f=null);f=Xh(a,b,g,f);a.u("%s\n",f);a.N=b;e-=b.M-k;c++}}}
l.zb=function(a,b,c){if(b)if(a){0>this.g&&this.i.length&&(this.g=0);if(0>this.g||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.toLowerCase().replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if('"'==g||"'"==g)e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Wa(a.substring(d,f))),d=f+1}}return b};
function Wh(a,b,c){var d=!0;try{b.length&&"end"!=b?c||a.u("%s%s\n",">> ",b):(a.P&&(a.u("ended assemble at %s\n",uh(a.V)),a.N=a.V,a.P=!1),b="");var e=b.charAt(0);if('"'==e||"'"==e)return!0;a.Z=null;if(Ub(a)&&0<b.length){a.P&&(b="a "+uh(a.V)+" "+b);var f=b.replace(/ +/g," ").split(" ");if(f&&f.length)for(var g=f[0],h=g.charAt(0),k=1;k<g.length;k++){var m=g.charAt(k);if("?"==h||"r"==h||"a">m||"z"<m){f[0]=g.substr(k);f.unshift(g.substr(0,k));break}}switch(f[0].charAt(0)){case "a":var p=ph(a,f[1],!0);
if(p)if(a.V=p,void 0===f[2])a.u("begin assemble at %s\n",uh(p)),a.P=!0,gd(a.A);else{a.u("not supported yet\n");var u=[];if(u.length){for(var r=0;r<u.length;r++)a.cc(p,u[r],1);a.u("%s\n",Xh(a,a.V))}}break;case "b":a:{var q=f[0],y=f[1],D=b;if("?"==y)a.u("breakpoint commands:\n"),a.u("\tbi [p]\ttoggle break on input port [p]\n"),a.u("\tbo [p]\ttoggle break on output port [p]\n"),a.u("\tbp [a]\tset exec breakpoint at addr [a]\n"),a.u("\tbr [a]\tset read breakpoint at addr [a]\n"),a.u("\tbw [a]\tset write breakpoint at addr [a]\n"),
a.u("\tbc [a]\tclear breakpoint at addr [a]\n"),a.u("\tbl\tlist all breakpoints\n"),a.u("\tbn [n]\tbreak after [n] instruction(s)\n");else{var E=q.charAt(1);if("l"==E){var aa=Vh(a,a.j);aa+=Vh(a,a.O);(aa+=Vh(a,a.D))||a.u("no breakpoints\n")}else if("n"==E)a.Y=vg(a,y),a.u("break after %d instruction(s)\n",a.Y);else if(void 0===y)a.u("missing breakpoint address\n");else{var F=Hg();if("*"!=y&&(F=ph(a,y,!0),!F))break a;y=Ia(F.M);if("c"==E)null==F.M?(jh(a),a.u("all breakpoints cleared\n")):Th(a,a.j,F)||
Th(a,a.O,F)||Th(a,a.D,F)||a.u("breakpoint missing: %s\n",uh(F));else if("i"==E){var sa=a.u;var X=a.J,ba=F.M;if(void 0===ba){X.G=!X.G;var ka=X.G}else void 0===X.C[ba]&&(X.C[ba]=[null,!1]),X.C[ba][1]=!X.C[ba][1],ka=X.C[ba][1];sa.call(a,"breakpoint %s: port %s (input)\n",ka?"enabled":"cleared",y)}else if("o"==E){var Fa=a.u;var Da=a.J,$b=F.M;if(void 0===$b){Da.H=!Da.H;var Ig=Da.H}else void 0===Da.D[$b]&&(Da.D[$b]=[null,!1]),Da.D[$b][1]=!Da.D[$b][1],Ig=Da.D[$b][1];Fa.call(a,"breakpoint %s: port %s (output)\n",
Ig?"enabled":"cleared",y)}else null!=F.M&&(th(a,F,D),"p"==E?a.Pa(a.j,F):"r"==E?a.Pa(a.O,F):"w"==E?a.Pa(a.D,F):a.u("unknown breakpoint command: %s\n",E))}}}break;case "c":var Jg=a.S;Jg.D&&(Jg.D.value="");break;case "d":a:{var ac,bc=f[0],eb=f[1],Eb=f[2],aj=f[3];if("?"==eb){var cc="";for(ac in t)a.ma[ac]&&(cc&&(cc+=","),cc+=ac);cc+=",state,symbols";a.u("dump memory commands:\n");a.u("\tdb [a] [#]    dump # bytes at address a\n");a.u("\tdw [a] [#]    dump # words at address a\n");a.u("\tdd [a] [#]    dump # dwords at address a\n");
a.u("\tdh [#] [#]    dump # instructions from history\n");cc.length&&a.u("dump extension commands:\n\t%s\n",cc)}else if("state"==eb){var se=yi(a.S,!0);if("console"==Eb)console.log(se);else{var Kg=a.S;Kg.D&&(Kg.D.value="");se&&a.u("%s\n",se)}}else if("symbols"==eb)for(var te=0;te<a.F.length;te++){var ue=a.F[te],dc;for(dc in ue.sa)if("."!=dc.charAt(0)){var Lg=ue.sa[dc].o;if(void 0!==Lg){var Mg=ue.sa[dc].l;Mg&&(dc=Mg);a.u("%s %s\n",w(Lg,4),dc)}}}else{if("d"==bc){for(ac in t)if(f[1]==ac){var Ng=a.ma[ac];
Ng?(f.shift(),f.shift(),Ng(f)):a.u("no dump registered for %s\n",eb);break a}eb||(bc=a.Ea||"db")}else a.Ea=bc;if("dh"==bc){var Og=eb,Pg=Eb,Qg="",Rg=0,Sa=a.W,fb=a.I;if(fb.length){var Ha=+Og||a.xa,vc=+Pg||10;isNaN(Ha)?Ha=vc:Qg="more ";Ha>fb.length&&(a.u("note: only %d available\n",fb.length),Ha=fb.length);Sa-=Ha;0>Sa&&(null==fb[fb.length-1].M?(Ha=Sa+Ha,Sa=0):Sa+=fb.length);var ve=[];"call"==Pg&&(vc=1E5,ve=["CALL"]);void 0!==Og&&a.u("%d instructions earlier:\n",Ha);for(var we="";0<vc&&Sa!=a.W;){var Sg=
fb[Sa++];if(null==Sg.M)break;var wc=Hg(Sg.M),bj=Ha--,Tg=Xh(a,wc,"history",bj);if(!ve.length||0<=Tg.indexOf(ve[0]))we+=Tg+"\n";wc.Ib&&(Sa+=wc.Ib,vc-=wc.Ib,Ha-=wc.Ib);Sa>=fb.length&&(Sa=0);a.xa=Ha;Rg++;vc--}we&&a.u("%s\n",we)}Rg||(a.u("no %shistory available\n",Qg),a.xa=void 0)}else{var nd=ph(a,eb);if(nd){var od=0;Eb&&("l"==Eb.charAt(0)&&(Eb=Eb.substr(1)||aj),od=vg(a,Eb)>>>0,65536<od&&(od=65536));for(var xc="",pd="dd"==bc?4:"dw"==bc?2:1,qd=pd*od||128,cj=qd+15>>4||1;cj--&&0<qd;){var xe=0,ye=0,yc,ze=
"",Ug="";eb=uh(nd);for(yc=16;0<yc&&0<qd;yc--){var rd=a.Ga(nd,1);xe|=rd<<(ye++<<3);ye==pd&&(ze+=w(xe,2*pd),ze+=1==pd?9==yc?"-":" ":"  ",xe=ye=0);Ug+=32<=rd&&127>rd?String.fromCharCode(rd):".";qd--}xc&&(xc+="\n");xc+=eb+"  "+ze+(0==yc?" "+Ug:"")}xc&&a.u("%s\n",xc);a.ta=nd}}}}break;case "e":if("else"==f[0])break;var sd=1,Vg=255,Wg=a.Ga,Xg=a.cc;"ew"==f[0]&&(sd=2,Vg=65535,Wg=a.Eb,Xg=a.Zc);var Yg=sd<<1,Zg=f[1];if(null==Zg)a.u("edit memory commands:\n"),a.u("\teb [a] [...]  edit bytes at address a\n"),a.u("\tew [a] [...]  edit words at address a\n");
else{var td=ph(a,Zg);if(td)for(var ud=2;ud<f.length;ud++){var zc=Bg(a,f[ud]);if(void 0===zc){a.u("unrecognized value: %s\n",f[ud]);break}zc&~Vg&&a.u("warning: %x exceeds %s-byte value\n",zc,sd);var dj=Wg.call(a,td);a.u("changing %s from %#0*2x to %#0*2x\n",uh(td),Yg,dj,Yg,zc);Xg.call(a,td,zc,sd)}}break;case "f":si(a,f[1]);break;case "g":a:{var $g=f[1],ej=b;if(void 0!==$g){var Ae=ph(a,$g,!0);if(!Ae)break a;th(a,Ae,ej);a.Pa(a.j,Ae,!0)}Oh(a,!0)||c||a.u("cpu busy or unavailable, run command ignored\n")}break;
case "h":a:{if(a.flags.la){var ah="halting";Zc(a)}else{if(Wb(a,!0))break a;ah="already halted"}c||a.u("%s\n",ah)}break;case "i":if("if"==f[0]){var Ac=b.substr(2);Ac=Wa(Ac);if(Bg(a,Ac)){c||a.u("true: %s\n",Ac);var bh=!0}else c||a.u("false: %s\n",Ac),bh=!1;bh||(d=!1);break}if("int"==f[0]){var fj=f[1];if(a.A.O&512){var Be=Bg(a,fj);if(null==Be)var Ce=!1;else a.u("requesting interrupt level %d\n",Be),ie(a.A,Be),Ce=!0}else a.u("interrupts disabled (use rif=1 to enable)\n"),Ce=!1;Ce||(d=!1);break}var De=
f[1];if(De&&"?"!=De){var Ee=vg(a,De);if(void 0!==Ee){var gj=Hc(a.J,Ee);a.u("%#06x: %#04x\n",Ee,gj)}}else a.u("input commands:\n"),a.u("\ti [p]\tread port [p]\n"),a.u("warning: port accesses can affect hardware state\n");break;case "k":var hj=f[0];if("?"==f[1])a.u("stack trace commands:\n"),a.u("\tk\tshow frame addresses\n"),a.u("\tks\tshow symbol information\n");else{var Fe=0,ch=Hg(),Bc=Hg(a.A.N);for(a.u("stack trace for %s\n",uh(Bc));10>Fe;){for(var Fb=null,ij=256;65536>Bc.M>>>0;){ch.M=a.Eb(Bc,2);
if(null==Bc.M||!ij--)break;for(var jj=a,vd=ch,dh=null,Cc=vd.M,eh=Cc,Ge=1;6>=Ge&&Cc;Ge++){if(2<Ge){vd.M=Cc;var wd=Xh(jj,vd);if(0<=wd.indexOf("CALL")){var fh=wd.indexOf(" ");if(Cc+(wd.indexOf(" ",fh+1)-fh-1)/2==eh){dh=wd;break}}}Cc--}vd.M=eh;if(Fb=dh)break}if(!Fb||null==Fb)break;var gh=null;if("ks"==hj){var hh=Fb.match(/[0-9A-F]+$/);hh&&(gh=ui(a,hh[0]))}Fb=Oa(Fb,50)+"  ;"+(gh||"stack="+uh(Bc));a.u("%s\n",Fb);Fe++}Fe||a.u("no return addresses found\n")}break;case "l":"ln"==f[0]&&ui(a,f[1],!0);break;
case "m":a:{var gb,hb=null,fa=f[1];"?"==fa&&(fa=void 0);if(void 0!==fa){var sb=0;if("all"==fa)sb=-257,fa=null;else if("on"==fa)hb=!0,fa=null;else if("off"==fa)hb=!1,fa=null;else{"keys"==fa&&(fa="key");"kbd"==fa&&(fa="keyboard");for(gb in t)if(fa==gb){sb=t[gb];hb=!!(a.ga&sb);break}if(!sb){a.u("unknown message category: %s\n",fa);break a}}if(sb)if("on"==f[2])a.ga|=sb,hb=!0;else if("off"==f[2]&&(a.ga&=~sb,hb=!1,0x800000000000==sb)){for(var He=0;He<a.aa.length;He++)a.u("%s\n",a.aa[He]);a.aa=[]}}var kj=
0,Dc="";for(gb in t)if(!fa||fa==gb){var lj=!!(a.ga&t[gb]);if(null===hb||hb==lj)Dc&&(Dc+=","),++kj%10||(Dc+="\n\t"),"key"==gb&&(gb="keys"),Dc+=gb}void 0===fa&&a.u("message commands:\n\tm [category] [on|off]\tturn categories on/off\n");a.u("%s%s\n",null!==hb?hb?"messages on:  ":"messages off: ":"message categories:\n\t",Dc||"none");lh(a)}break;case "o":var Ie=f[1],mj=f[2];if(Ie&&"?"!=Ie){var Je=vg(a,Ie,"port #"),Ke=vg(a,mj);void 0!==Je&&void 0!==Ke&&(Kc(a.J,Je,Ke),a.u("%#06x: %#04x\n",Je,Ke))}else a.u("output commands:\n"),
a.u("\to [p] [b]\twrite byte [b] to port [p]\n"),a.u("warning: port accesses can affect hardware state\n");break;case "p":if("print"==f[0]){wi(a,b.substr(5));break}var ih="pr"==f[0]?1:0,nj=1+ih;if(a.T)a.u("step in progress\n");else{var Le=Hg(a.A.j);switch(a.Ga(Le)){case 205:a.T=nj,rh(Le,3)}a.T?(a.Pa(a.j,Le,!0),Oh(a)||(a.S&&a.S.Za(),a.T=0)):xi(a,ih?"tr":"t")}break;case "r":if("reset"==b){a.S&&a.S.reset();break}Qh(a,f);break;case "s":vi(a,f);break;case "t":xi(a,f[0],f[1]);break;case "u":Rh(a,f[1],f[2],
8);break;case "v":if("var"==f[0]){ti(a,b.substr(3))||(d=!1);break}a.u("%s version %s (%s%s%s)\n","PCx80","2.20",a.A.model,",RELEASE",",TYPEDARRAYS");a.u("%s\n",db());break;case "?":if(f[1]){wi(a,b.substr(1));break}var Me="commands:",Ne;for(Ne in zi)Me+="\n"+Oa(Ne,9)+zi[Ne];je(a)||(Me+="\nnote: frequency/history disabled if no exec breakpoints");a.u("%s\n",Me);break;default:a.u("unknown command: %s\n",b),d=!1}}}catch(kh){a.u("debugger error: %s\n",kh.stack||kh.message),d=!1}return d}
function fd(a,b,c){b=a.zb(b,c);for(var d in b)if(!Wh(a,b[+d]))return!1;return!0}
var zi={"?":"help/print","a [#]":"assemble","b [#]":"breakpoint",c:"clear output","d [#]":"dump memory","e [#]":"edit memory",f:"frequencies","g [#]":"go [to #]",h:"halt","i [#]":"input port #","if":"eval expression","int [#]":"request interrupt",k:"stack trace",ln:"list nearest symbol(s)",m:"messages","o [#]":"output port #",p:"step over",print:"print expression",r:"dump/set registers",reset:"reset machine",s:"set options","t [#]":"trace","u [#]":"unassemble",v:"print version","var":"assign variable"},
Gg=8080,Yh=8086,Zh="NONE ACI ADC ADD ADI ANA ANI CALL CC CM CNC CNZ CP CPE CPO CZ CMA CMC CMP CPI DAA DAD DCR DCX DI EI HLT IN INR INX JMP JC JM JNC JNZ JP JPE JPO JZ LDA LDAX LHLD LXI MOV MVI NOP ORA ORI OUT PCHL POP PUSH RAL RAR RET RC RM RNC RNZ RP RPE RPO RZ RLC RRC RST SBB SBI SHLD SPHL STA STAX STC SUB SUI XCHG XRA XRI XTHL".split(" "),$h="NONE ADC ADC ADD ADD AND AND CALL CALLC CALLS CALLNC CALLNZ CALLNS CALLP CALLNP CALLZ NOT CMC CMP CMP DAA ADD DEC DEC CLI STI HLT IN INC INC JMP JC JS JNC JNZ JNS JP JNP JZ MOV MOV MOV MOV MOV MOV NOP OR OR OUT JMP POP PUSH RCL RCR RET RETC RETS RETNC RETNZ RETNS RETP RETNP RETZ ROL ROR RST SBB SBB MOV MOV MOV MOV STC SUB SUB XCHG XOR XOR XCHG".split(" "),
zh=0,Ah=1,Bh=2,Ch=3,Dh=4,Eh=5,Fh=6,yh=7,Gh=8,Hh=9,Ih=10,Jh=11,Kh=12,Lh=13,Mh=14,wh="B C D E H L M A BC DE HL SP PC PS PSW".split(" "),ci=15,bi=240,li=3840,di=61440,ai=0,gi=1,hi=2,ii=3,ki=16,Q=32,ji=64,mi=128,R=yh<<8|ki|gi,S=zh<<8|ki|gi,T=Ah<<8|ki|gi,U=Bh<<8|ki|gi,V=Ch<<8|ki|gi,W=Dh<<8|ki|gi,Y=Eh<<8|ki|gi,Z=Fh<<8|ki|gi|ji,Ai=Gh<<8|ki|ii,Bi=Hh<<8|ki|ii,Ci=Ih<<8|ki|ii,Di=Jh<<8|ki|ii,Ei=Mh<<8|ki|ii,fi=4096,ei=8192,P=16384,ni=32768,nh=[[45],[42,Ai,Q],[71,Ai|ji,R|P],[29,Ai],[28,S],[22,S],[44,S,Q],[63],
[45,ni],[21,Ci|P,Ai],[40,R|P,Ai|ji],[23,Ai],[28,T],[22,T],[44,T,Q],[64],[45,ni],[42,Bi,Q],[71,Bi|ji,R|P],[29,Bi],[28,U],[22,U],[44,U,Q],[52],[45,ni],[21,Ci|P,Bi],[40,R|P,Bi|ji],[23,Bi],[28,V],[22,V],[44,V,Q],[53],[45,ni],[42,Ci,Q],[68,51|ji,Ci|P],[29,Ci],[28,W],[22,W],[44,W,Q],[20],[45,ni],[21,Ci|P,Ci],[41,Ci|P,51|ji],[23,Ci],[28,Y],[22,Y],[44,Y,Q],[16,R|P],[45,ni],[42,Di,Q],[70,51|ji,R|P],[29,Di],[28,Z],[22,Z],[44,Z,Q],[72],[45,ni],[21,Ci|P,Di],[39,R|P,51|ji],[23,Di],[28,R],[22,R],[44,R,Q],[17],
[43,S,S],[43,S,T],[43,S,U],[43,S,V],[43,S,W],[43,S,Y],[43,S,Z],[43,S,R],[43,T,S],[43,T,T],[43,T,U],[43,T,V],[43,T,W],[43,T,Y],[43,T,Z],[43,T,R],[43,U,S],[43,U,T],[43,U,U],[43,U,V],[43,U,W],[43,U,Y],[43,U,Z],[43,U,R],[43,V,S],[43,V,T],[43,V,U],[43,V,V],[43,V,W],[43,V,Y],[43,V,Z],[43,V,R],[43,W,S],[43,W,T],[43,W,U],[43,W,V],[43,W,W],[43,W,Y],[43,W,Z],[43,W,R],[43,Y,S],[43,Y,T],[43,Y,U],[43,Y,V],[43,Y,W],[43,Y,Y],[43,Y,Z],[43,Y,R],[43,Z,S],[43,Z,T],[43,Z,U],[43,Z,V],[43,Z,W],[43,Z,Y],[26],[43,Z,R],[43,
R,S],[43,R,T],[43,R,U],[43,R,V],[43,R,W],[43,R,Y],[43,R,Z],[43,R,R],[3,R|P,S],[3,R|P,T],[3,R|P,U],[3,R|P,V],[3,R|P,W],[3,R|P,Y],[3,R|P,Z],[3,R|P,R],[2,R|P,S],[2,R|P,T],[2,R|P,U],[2,R|P,V],[2,R|P,W],[2,R|P,Y],[2,R|P,Z],[2,R|P,R],[73,R|P,S],[73,R|P,T],[73,R|P,U],[73,R|P,V],[73,R|P,W],[73,R|P,Y],[73,R|P,Z],[73,R|P,R],[66,R|P,S],[66,R|P,T],[66,R|P,U],[66,R|P,V],[66,R|P,W],[66,R|P,Y],[66,R|P,Z],[66,R|P,R],[5,R|P,S],[5,R|P,T],[5,R|P,U],[5,R|P,V],[5,R|P,W],[5,R|P,Y],[5,R|P,Z],[5,R|P,R],[76,R|P,S],[76,R|
P,T],[76,R|P,U],[76,R|P,V],[76,R|P,W],[76,R|P,Y],[76,R|P,Z],[76,R|P,R],[46,R|P,S],[46,R|P,T],[46,R|P,U],[46,R|P,V],[46,R|P,W],[46,R|P,Y],[46,R|P,Z],[46,R|P,R],[18,R|P,S],[18,R|P,T],[18,R|P,U],[18,R|P,V],[18,R|P,W],[18,R|P,Y],[18,R|P,Z],[18,R|P,R],[58],[50,Ai],[34,51],[30,51],[11,51],[51,Ai],[4,R|P,Q|gi],[65,mi],[62],[54],[38,51],[30,51|ni],[15,51],[7,51],[1,R|P,Q|gi],[65,mi],[57],[50,Bi],[33,51],[48,Q|gi,R|P],[10,51],[51,Bi],[74,R|P,Q|gi],[65,mi],[55],[54,ni],[31,51],[27,R|P,Q|gi],[8,51],[7,51|ni],
[67,R|P,Q|gi],[65,mi],[61],[50,Ci],[37,51],[78,Di|ji|P,Ci|P],[14,51],[51,Ci],[6,R|P,Q|gi],[65,mi],[60],[49,Ci],[36,51],[75,Ci|P,Bi|P],[13,51],[7,51|ni],[77,R|P,Q|gi],[65,mi],[59],[50,Ei],[35,51],[24],[12,51],[51,Ei],[47,R|P,Q|gi],[65,mi],[56],[69,Di|P,Ci|P],[32,51],[25],[9,51],[7,51|ni],[19,R|P,Q|gi],[65,mi]],Nh=1E3;vb(function(){for(var a=Kb("pcx80","debugger"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);d=new Fg(d);Jb(d,c)}});
function Fi(a,b,c){z.call(this,"Computer",a,16384);this.flags.ka=!1;Gi(this,b);this.N=bd(this,"autoPower",a);this.j=0;this.V=a.busWidth||a.buswidth;this.g=Hi;this.I=null;this.G=this.T=!1;this.url=bd(this,"url")||"";(Math.random()+.1).toString(36);this.i=Ii(this);if(this.A=Ob("CPU",this.id)){this.L=Ob("Debugger",this.id);this.C=[];for(b=null;b=ic(this,"Video",b);)this.C.push(b);this.J=new kc({id:this.Sa+".bus",busWidth:this.V},this.A,this.L);var d=Mb(this.id);if(this.D=(this.F=Ob("Panel",this.id))&&
this.F.R.print)for(b=0;b<d.length;b++){var e=d[b];e.ba=this.F.ba;e.print=this.F.print;e.ia=this.F.ia}this.ia("PCx80 v2.20\nCopyright \u00a9 2012-2023 Jeff Parsons <Jeff@pcjs.org>\nLicense: MIT <https://www.pcjs.org/LICENSE.txt>");for(b=0;b<d.length;b++)e=d[b],e.Fa&&e.Fa(this,this.J,this.A,this.L);b=null;e=bd(this,"resume",a);void 0!==e&&(1<e.length?b=this.H=e:this.g=parseInt(e,10));e=!1;d=bd(this,"state");d||(e=!0,d=a.state);d&&(b=this.O=d,e||(this.G=!0,this.g=Hi),this.g&&(this.K=new Ld(this,"2.20"),
this.K.load()?b=null:delete this.K));!b&&this.g&&(b=Ji(this))&&(this.G=!0);if(b){var f=this;$a(b,null,!0,function(g,h,k){k?(f.H=null,f.G=!1,f.ba("Unable to load machine state from server (error "+k+(h?": "+Wa(h):"")+")")):(f.I=h,f.T=!0);Vb(f)})}else Vb(this);this.R.power||(this.N=!0);!c&&this.N&&this.wait(this.mb)}else x("Unable to find CPU component")}ta(Fi,z);
function Gi(a,b){if(!b){var c,d=n.resources;if("object"==typeof d&&(c=d.parms))try{b=eval("("+c+")")}catch(e){x(e.message+" ("+c+")")}}a.U=b}function bd(a,b,c){var d=n.resources,e=b.toLowerCase();e=pb(b)||pb(e);void 0===e&&a.U&&(e=a.U[b]);void 0===e&&c&&(e=c[b]);void 0===e&&"object"==typeof d&&d[b]&&(e=b);return e}l=Fi.prototype;l.wait=function(a,b){for(var c=this,d=Mb(this.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:this;if(!Ub(f)){Ub(f,function(){c.wait(a,b)});return}}a.call(this,b)};
function Ki(a,b){var c=new Ld(a,"2.20",Li);if(c.load()&&Mi(c)){var d=c.get(Ni),e=b?b.get(Ni):"unknown";d!=e&&(a.ba("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}
l.mb=function(a){void 0===a&&(a=this.g||(this.I?Oi:Hi));if(!this.j){this.j++;var b=!1,c=!1;this.P=!1;var d=this.K||new Ld(this,"2.20");if(a==Pi)b=!0;else if(a>Hi){if(d.load(this.I)){this.B=new Ld(this,"2.20",Qi);this.B.load()&&(Ri(),a=Si,Ti(this.B));this.B.set(Ni,Qa("%T",new Date));this.B.store();var e=this.g&&!this.G;if(a==Oi||Ib("Click OK to restore the previous PCx80 machine state, or CANCEL to reset the machine.")){if(c=Mi(d)){var f=d.get("code"),g=d.get("data");f&&("ok"==f?d.load(g):("error"==
f&&"no machine state"!=g?(this.ba("Error: "+g),"unable to verify user"==g&&(lb(Ui,""),this.i=null)):this.ia(f+": "+g),Ti(d),d.load()?(c=Mi(d),e=!0):c=!1))}e&&Ki(this,c?d:null)}else a==Si&&d.clear()}else Ki(this);delete this.I;delete this.K}e=Mb(this.id);for(f=0;f<e.length;f++)g=e[f],g!==this&&g!=this.A&&(c=Vi(this,g,d,b,c));b=[d,a,c];a!=Pi?this.wait(this.Ec,b):this.Ec(b)}};
function Vi(a,b,c,d,e){if(!b.flags.ka){b.flags.ka=!0;if(b.wa){var f=null;e&&((f=c.get(b.id))||(f=c.get(b.id.replace(/-[0-9]+\./i,"."))));"string"===typeof f&&(f=null);!b.wa(f,d)&&f&&(x("Unable to restore state for "+b.type),a.O&&!a.T?(c.clear(),a.g=Hi,n.location&&n.location.reload()):a.P=!0,b.wa(null),e=!1)}if(!d&&b.xc)for(a=b.xc.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
l.Ec=function(a){var b=a[0],c=0>a[1];a=a[2];this.X=!0;this.flags.ka=!0;var d=this.R.power;d&&(d.textContent="Shutdown");this.A&&(Vi(this,this.A,b,c,a),this.A.jb());this.P&&(Ri(),b.clear());!c&&this.B&&(this.B.clear(),delete this.B);this.j=0};function Ri(){xb("There may be a problem with your PCx80 machine.")}
function yi(a,b,c){var d="none";if(a.j)return null;a.j--;var e=new Ld(a,"2.20"),f=new Ld(a,"2.20",Li),g=Qa("%T",new Date);f.set(Ni,g);e.set(Ni,g);e.set(Wi,"2.20");e.set(Xi,n.location?n.location.href:null);e.set(Yi,db());if(a.A&&a.A.va){c&&jd(a.A);var h=a.A.va(b,c);"object"===typeof h&&e.set(a.A.id,h);c&&(a.A.flags.ka=!1,!1===h&&(d=null))}g=Mb(a.id);for(var k=0;k<g.length;k++){var m=g[k];m.flags.ka&&(m.va&&(h=m.va(b,c),"object"===typeof h&&e.set(m.id,h)),c&&(m.flags.ka=!1,!1===h&&(d=null)))}d&&(c?
(g=h=!1,b?(a.i&&Zi(a,a.i,e.toString()),f.store()&&e.store()||(d=null,h=g=!0)):a.g&&(h=!0,g=a.g==$i),h&&e.clear(g)):d=e.toString());c&&(a.flags.ka=!1,b=a.R.power)&&(b.textContent="Power");a.j=0;return d}l.reset=function(){this.J&&this.J.reset&&(ec(this,"Resetting "+this.J.type),this.J.reset());for(var a=Mb(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.J&&c.reset&&(ec(this,"Resetting "+c.type),c.reset())}};
l.start=function(a,b){for(var c=Mb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};l.stop=function(a,b){for(var c=Mb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
l.ea=function(a,b,c){var d=this;switch(b){case "power":return this.R[b]=c,c.onclick=function(){d.j||(d.flags.ka?yi(d,!1,!0):d.wait(d.mb))},!0;case "reset":return this.R[b]=c,c.onclick=function(){if(d.flags.ka&&!d.j)if(d.g&&!d.H){var e=Ib("Click OK to save changes to this PCx80 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");yi(d,e,!0);!e&&d.O?n.location&&n.location.reload():d.mb(Hi)}else d.reset(),d.A&&d.A.jb()},!0;case "save":if(La())c.parentNode.removeChild(c);else return this.R[b]=
c,c.onclick=function(){var e=Ii(d,!0);if(e){var f=!!(d.g&&!d.H||d.O),g=yi(d,f);f?Zi(d,e,g):d.ba("Resume disabled, machine state not saved")}},!0}return!1};
function Ii(a,b){var c=a.i;c||((c=kb(Ui),void 0!==c)?!c&&b&&(b=null,window&&(b=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c=b)&&((c=oj(a,c))||a.ba("The user ID is invalid.")):b&&a.ba("Browser local storage is not available"));return c}
function oj(a,b){a.i=null;b=$a(bb()+"/api/v1/user?req=verify&user="+b);var c=b[1];if(!b[0]&&c)try{b=eval("("+c+")"),b.code&&"ok"==b.code&&(lb(Ui,b.data),a.i=b.data)}catch(d){x(d.message+" ("+c+")")}return a.i}function Ji(a){var b=null;a.i&&(b=bb()+"/api/v1/user?req=load&user="+a.i+"&state="+pj(a,"2.20"));return b}
function Zi(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=pj(a,"2.20");d.data=c;b=$a(bb()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.ba("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.ba(c),lb(Ui,""),a.i=null)}}
function ic(a,b,c){a=Mb(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}l.Za=function(a){if(this.C.length){var b=0,c=0;!a&&xa&&(b=n.scrollX,c=n.scrollY);var d=this.C[0];d.W&&d.W.focus();!a&&n.scrollTo&&n.scrollTo(b,c)}};
function Bd(a,b){a.A&&(a=a.A,a.gb&&(b||!a.flags.la||a.flags.Dc)&&(K(a,"A",a.i),K(a,"B",a.B),K(a,"C",a.C),K(a,"BC",Md(a),4),K(a,"D",a.D),K(a,"E",a.F),K(a,"DE",Od(a),4),K(a,"H",a.G),K(a,"L",a.H),K(a,"HL",C(a),4),K(a,"SP",a.N,4),K(a,"PC",a.j,4),b=Kd(a),K(a,"PS",b,4),K(a,"IF",b&512?1:0,1),K(a,"SF",b&128?1:0,1),K(a,"ZF",b&64?1:0,1),K(a,"AF",b&16?1:0,1),K(a,"PF",b&4?1:0,1),K(a,"CF",b&1?1:0,1)),b=a.R.speed)&&(b.textContent=a.flags.la&&a.Z?a.Z.toFixed(2)+"Mhz":"Stopped")}
var Qi="failsafe",Li="validate",Ni="timestamp",Wi="version",Xi="url",Yi="browser",Ui="user",Pi=-1,Hi=0,Oi=1,Si=2,$i=3;vb(function(){for(var a=Kb("pcx80","machine"),b=0;b<a.length;b++){var c=a[b],d=Lb(c);c=Kb("pcx80","computer",c);for(var e=0;e<c.length;e++){var f=c[e],g=Lb(f);g=new Fi(g,d,!0);Jb(g,f);g.N&&g.wait(g.mb)}}});wb.show.push(function(){for(var a=Kb("pcx80","computer"),b=0;b<a.length;b++){var c=Lb(a[b]);if(c=Ob("Computer",c.id))c.flags.Qb=!1,c.X&&!c.flags.ka&&c.mb(Pi)}});
wb.exit.push(function(){for(var a=Kb("pcx80","computer"),b=0;b<a.length;b++){var c=Lb(a[b]);if(c=Ob("Computer",c.id))c.flags.Qb=!0,c.flags.ka&&yi(c,!(!c.g||c.H),!0)}});function Ld(a,b,c){this.id=a.id;this.L=a.L;this.i="";this.g={};this.A=this.J=!1;this.key=pj(a,b,c);Ti(this,a.Bd)}l=Ld.prototype;l.set=function(a,b){try{this.g[a]=b}catch(c){}};l.get=function(a){return this.g[a]||null};l.data=function(){return this.g};
l.load=function(a){return a?(this.i=a,this.A=!0,this.J=!1,!0):this.A?!0:ib()&&(a=kb(this.key))?(this.i=a,this.A=!0):!1};function Mi(a){var b=!0;if(!a.J)try{a.g=JSON.parse(a.i),a.J=!0}catch(c){x(c.message||c),b=!1}return b}l.store=function(){var a=!0;if(ib()){var b=JSON.stringify(this.g);lb(this.key,b)||(x("Unable to store "+b.length+" bytes in browser local storage"),a=!1)}return a};l.toString=function(){return this.g?JSON.stringify(this.g):this.i};
function Ti(a,b){a.i="";a.g={};a.A=a.J=!1;b&&a.set("parms",b)}l.clear=function(a){Ti(this);var b=[];if(ib())try{for(var c=0,d=n.localStorage.length;c<d;c++)b.push(n.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){if(ib())try{n.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}};function pj(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}var qj=0;
function rj(a,b,c,d,e,f,g,h,k){h("Loading "+a+"...");$a(a,null,!0,function(m,p,u){u?(p||(p="unable to load "+a+" ("+u+")"),k(m,p,null)):sj(p,a,b,c,d,e,f,g,h,k)})}
function sj(a,b,c,d,e,f,g,h,k,m){function p(u,r,q){if(q)m(u,q,null);else{c&&(Gb(c,b,r),(q=b)&&0>q.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(q=window.location.pathname+q),f?"}"==f.slice(-1)?(f=f.slice(0,-1),1<f.length&&(f+=",")):f='{state:"'+f+'",':f="{",f+='url:"'+q+'"}',"object"==typeof resources&&(q=null),f=f.replace(/\$/g,"$$$$").replace(/'/g,"&apos;"),g&&(u=r.match(/(<machine[^>]*\sclass=)(['"])(.*?)(\2[^>]*>)/))&&(r=r.replace(u[0],u[1]+u[2]+g+u[4]),g=""),(u=r.match(/(<machine[^>]*\sdebugger=)(['"])(available)(\2[^>]*>)/))&&
(r=r.replace(u[0],u[1]+u[2]+"optional"+u[4])),r=r.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(g?' class="'+g+'"':"")+(f?" parms='"+f+"'":"")+(q?' url="'+q+'"':"")));h||(r=r.replace(/(<xsl:variable name="APPNAME">).*?(<\/xsl:variable>)/,"$1"+d+"$2"),r=r.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1"+e+"$2"),r=r.replace(/<xsl:variable name="APPVERSION"(\/>|>[^<]*<\/xsl:variable>)/,'<xsl:variable name="APPVERSION">2.20</xsl:variable>'));u=null;if("<"==r.charAt(0))try{h||
(r=r.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(u=new window.ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(r)):u=(new window.DOMParser).parseFromString(r,"text/xml")}catch(y){u=null,r=y.message}else r="unrecognized XML: "+(255<r.length?r.substr(0,255)+"...":r);m(b,r,u)}}a?h?tj(b,a,k,p):p(b,a,""):m(b,"no data",null)}
function tj(a,b,c,d){var e;if(e=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(b)){var f=e[2];c("Loading "+f+"...");$a(f,null,!0,function(g,h,k){if(k||!h)d(g,b,"unable to resolve XML reference: "+e[0]+" ("+k+")");else{if(k=e[3]){var m=h.match(new RegExp("<"+e[1]+"[^>]*>"));if(m){for(var p=m[0],u,r=/( [a-z]+=)(['"])(.*?)\2/gi;u=r.exec(k);)p=0>p.toLowerCase().indexOf(u[1].toLowerCase())?p.replace(">",u[0]+">"):p.replace(new RegExp(u[1]+"(['\"])(.*?)\\1"),u[0]);m[0]!=p&&(h=h.replace(m[0],p))}else{d(g,b,"missing <"+
e[1]+"> in "+f);return}}h=h.replace(/<\?xml[^>]*>[\r\n]*/,"");b=b.replace(e[0],h);tj(g,b,c,d)}})}else d(a,b,"")}
function uj(a,b,c,d,e,f,g){function h(aa){if(void 0===u){var F=p&&Kb("machine-warning","",p);u=F&&F[0]||p}u&&(u.innerHTML=Ma(aa))}function k(aa,F){if("string"==typeof F&&0<=F.indexOf("<!DOCTYPE html>")){var sa=F.match(/<title>(?:PCjs: |)(.*?)<\/title>/);sa&&(F=sa[1])}h("Error: "+F+(aa?" ("+aa+")":""));r&&m();r=!1}function m(){--qj||Bb(!0)}var p,u,r=!0;qj++;Aa.machines[c]={};if(!d)return f&&Gb(c,"parms",f),m(),r;"true"==pb("debugger")&&0>d.indexOf("/debugger")&&(d=d.replace("/machine.xml","/debugger/machine.xml"));
try{if(p=document.getElementById(c)){var q,y=n.resources;if("object"==typeof y&&(q=y.css)){var D=document.head||document.getElementsByTagName("head")[0],E=document.createElement("style");E.type="text/css";E.styleSheet?E.styleSheet.cssText=q:E.appendChild(document.createTextNode(q));D.appendChild(E)}e||(e="/machines/"+b+"/xsl/components.xsl");b=b.split("/").pop();q=function(aa,F,sa){sa?rj(e||"","",a,b,"","",!1,h,function(X,ba,ka){if(ka)if(Gb(c,e||"",ba),h("Processing "+d+"..."),window.ActiveXObject||
"ActiveXObject"in window)(ka=sa.transformNode(ka))?(p.outerHTML=ka,m()):k(X,"transformNodeToObject failed");else if(document.implementation&&document.implementation.createDocument)if(ba=new XSLTProcessor,ba.importStylesheet(ka),ka=ba.transformToFragment(sa,document))if(ba=p.parentNode){var Fa=X=0,Da=p.getBoundingClientRect();0>Da.bottom&&(X=window.scrollX,Fa=window.scrollY);ba.replaceChild(ka,p);(p=document.getElementById(c))&&0>Da.bottom&&(ka=p.getBoundingClientRect(),Fa=window.performance&&window.performance.navigation.type==
window.performance.navigation.TYPE_RELOAD?0:Fa+Math.ceil(ka.height-Da.height),window.scrollTo(X,Fa));m()}else k(X,"invalid machine element: "+c);else k(X,"transformToFragment failed");else k(X,"unable to transform XML: unsupported browser");else k(X,ba)}):k(aa,F)};"<"!=d.charAt(0)?rj(d,c,a,b,f||"",g||"",!0,h,q):sj(d,"",c,a,b,f||"",g||"",!1,h,q)}else k(d,"missing machine element: "+c)}catch(aa){k(d,aa.message)}return r}function vj(a,b,c,d,e){Bb(!1);return uj("PCx86","pcx86",a,b,c,d,e)}
n.embedC1P=function(a,b,c,d,e){Bb(!1);return uj("C1Pjs","osi/c1p",a,b,c,void 0,e)};n.embedPC=vj;n.embedPCx86=vj;n.embedPCx80=function(a,b,c,d,e){Bb(!1);return uj("PCx80","pcx80",a,b,c,d,e)};n.embedPDP10=function(a,b,c,d,e){Bb(!1);return uj("PDPjs","dec/pdp10",a,b,c,d,e)};n.embedPDP11=function(a,b,c,d,e){Bb(!1);return uj("PDPjs","dec/pdp11",a,b,c,d,e)};
n.commandMachine=function(a,b,c,d,e,f){if("script"==e){d=!1;e=Aa.commands;c+=".machine";if(!f)delete e[c],d=!0;else if("string"==typeof f&&!e[c]){d=!0;for(var g=c,h=f.length,k=[],m=[],p="",u=null,r=0;r<h;r++){var q=f[r];if('"'==q||"'"==q)u&&q!=u?p+=q:(u?u=null:u=q,p&&(m.push(p),p=""));else{if(!u){if("\r"==q||"\n"==q)q=";";if(" "==q||"\t"==q||";"==q){p&&(m.push(p),p="");";"==q&&m.length&&(k.push(m),m=[]);continue}}p+=q}}p&&m.push(p);m.length&&k.push(m);e[g]=k;Pb(c)||(d=!1)}return d?(b&&(a.disabled=
!0),!0):!1}if(d&&(g=Ob(d,c+".machine"))&&(h=g.exports)&&(h=h[e]))return h.call(g,f)?(b&&(a.disabled=!0),!0):!1;console.log("unimplemented: commandMachine('"+c+"','"+d+"','"+e+"','"+f+"')");return!1};n.enableEvents=Bb;n.sendEvent=zb;})()

//# sourceMappingURL=pcx80.js.map
